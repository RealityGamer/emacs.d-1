<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-07-15 Sat 21:41 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My Emacs Configuration</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="John AnkarstrÃ¶m" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link href="https://fonts.googleapis.com/css?family=Playfair+Display" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" />
<link rel="stylesheet" href="config.css" type="text/css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">My Emacs Configuration</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org452e991">1. Introduction</a>
<ul>
<li><a href="#org0a074d1">1.1. &ldquo;Best of&rdquo;</a></li>
</ul>
</li>
<li><a href="#org38d2e9a">2. Packages</a>
<ul>
<li><a href="#orgfc3329b">2.1. Package management</a></li>
<li><a href="#org8d4a8ae">2.2. List of packages</a>
<ul>
<li><a href="#org4c7ab7b">Packages with configuration elsewhere</a></li>
<li><a href="#org5049152">Packages without interesting configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#basic-preferences">3. Basic preferences</a>
<ul>
<li><a href="#directories">3.1. Directories</a></li>
<li><a href="#keybindings">3.2. Keybindings</a></li>
<li><a href="#functions">3.3. Helper functions</a></li>
<li><a href="#session-management">3.4. Session management</a></li>
<li><a href="#org133b99f">3.5. Shebang mode detection</a></li>
</ul>
</li>
<li><a href="#org1863e10">4. Text editing</a>
<ul>
<li><a href="#multiple-cursors">4.1. Multiple cursors</a></li>
<li><a href="#visual-regexp">4.2. Search &amp; replace: <i>visual-regexp</i></a></li>
<li><a href="#alignment">4.3. Alignment</a>
<ul>
<li><a href="#org3c269fe">Aligning comments</a></li>
</ul>
</li>
<li><a href="#lisp">4.4. Working with Lisp</a>
<ul>
<li><a href="#paredit">Paredit</a></li>
<li><a href="#aggressive-indent">Aggressive indentation</a></li>
<li><a href="#common-lisp-indent">Common Lisp indentation</a></li>
</ul>
</li>
<li><a href="#regions">4.5. Working with regions</a>
<ul>
<li><a href="#expand-region"><i>expand-region</i></a></li>
<li><a href="#wrap-region"><i>wrap-region</i></a></li>
</ul>
</li>
<li><a href="#smart-open-line">4.6. Opening line below and above</a></li>
<li><a href="#commenting-lines">4.7. Commenting lines</a></li>
</ul>
</li>
<li><a href="#org746b3f6">5. Movement</a>
<ul>
<li><a href="#jumping">5.1. Quickly jumping around</a>
<ul>
<li><a href="#iy-go-to-char"><i>iy-go-to-char</i></a></li>
<li><a href="#avy"><i>avy</i></a></li>
</ul>
</li>
<li><a href="#windmove">5.2. Moving between windows: <i>windmove</i></a></li>
<li><a href="#beginning-end-of-line">5.3. Moving to the beginning and end of a line</a></li>
<li><a href="#scrolling-pleasantly">5.4. Scrolling pleasantly</a></li>
</ul>
</li>
<li><a href="#org7d023d1">6. Visual aids</a>
<ul>
<li><a href="#origami">6.1. Folding with <i>origami</i></a></li>
<li><a href="#show-trailing-whitespace">6.2. Highlighting superfluous whitespace</a></li>
<li><a href="#org91300c8">6.3. Prettify symbols mode</a></li>
<li><a href="#orgf9d7aba">6.4. <i>which-key</i></a></li>
</ul>
</li>
<li><a href="#org64a5604">7. Helpful tools</a>
<ul>
<li><a href="#helm">7.1. Helm</a></li>
<li><a href="#ivy">7.2. Ivy</a>
<ul>
<li><a href="#counsel-everything"><i>counsel-everything</i></a></li>
</ul>
</li>
<li><a href="#swiper">7.3. Swiper</a></li>
<li><a href="#projectile">7.4. Projectile</a></li>
<li><a href="#magit">7.5. Magit</a></li>
<li><a href="#eshell">7.6. Eshell</a></li>
<li><a href="#git-gutter">7.7. <i>git-gutter+</i></a></li>
<li><a href="#openwith">7.8. <i>openwith</i></a></li>
</ul>
</li>
<li><a href="#org002cbd1">8. Modes</a>
<ul>
<li><a href="#org-mode">8.1. Org</a>
<ul>
<li><a href="#org-tree-view"><i>org-tree-view</i></a>
<ul>
<li><a href="#org3446232">Minor mode definition</a></li>
<li><a href="#org724ef1f">Rendering the tree view</a></li>
<li><a href="#orgd419b99">Interacting with the tree view</a></li>
<li><a href="#orga4cb620">Helper functions</a></li>
<li><a href="#org88d5e53">Customizable options</a></li>
<li><a href="#orgbe564b2">Issues</a></li>
<li><a href="#org3a43ecb">Planned features</a></li>
</ul>
</li>
<li><a href="#org-make-wiktionary-link">Automatic Wiktionary links</a></li>
<li><a href="#org0693839">Tangling my configuration</a></li>
<li><a href="#org-beginning-of-line">Adjusting <i>org-beginning-of-line</i></a></li>
</ul>
</li>
<li><a href="#racket-mode">8.2. Racket</a></li>
<li><a href="#org7c20bb6">8.3. LaTeX</a></li>
<li><a href="#org1fd1294">8.4. Python</a></li>
</ul>
</li>
<li><a href="#e-mail">9. E-mail</a>
<ul>
<li><a href="#org38deb01">9.1. Gnus</a></li>
<li><a href="#orgca6a54e">9.2. <i>notmuch</i></a>
<ul>
<li><a href="#org02f6c20">Personal <i>mail</i> shell script</a></li>
<li><a href="#orga4d7ff5">Refresh status message</a></li>
<li><a href="#orga1fec13">Helm completion</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#custom-hooks">10. Custom hooks</a></li>
<li><a href="#visuals">11. Visuals</a>
<ul>
<li><a href="#orga39d29d">11.1. Theme configuration</a>
<ul>
<li><a href="#daylight-sets-color">Daylight-dependent default theme</a></li>
<li><a href="#dynamic-theme-settings">Dynamic theme settings</a></li>
<li><a href="#theme-switching">Switching between themes</a></li>
</ul>
</li>
<li><a href="#org08edc28">11.2. Fonts</a></li>
</ul>
</li>
<li><a href="#lang">12. Language configuration</a>
<ul>
<li><a href="#spelling">12.1. Spelling</a></li>
<li><a href="#swe">12.2. Swedish mode</a></li>
<li><a href="#combining-acute-accent">12.3. Combining acute accent</a></li>
</ul>
</li>
<li><a href="#rsi">13. Preventing repeated strain injury</a></li>
<li><a href="#org5ebb308">14. Operating systems</a>
<ul>
<li><a href="#wsl">14.1. Windows Subsystem for Linux (WSL)</a>
<ul>
<li><a href="#launching-emacs">Launching Emacs</a></li>
<li><a href="#wsl:default">Default programs</a>
<ul>
<li><a href="#wsl:web-browser">Web browser</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#osx">14.2. Mac OS X</a>
<ul>
<li><a href="#org82d89da">Fonts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org9c7d97d">15. Credits</a></li>
</ul>
</div>
</div>

<div id="outline-container-org452e991" class="outline-2">
<h2 id="org452e991"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
Welcome to my Emacs configuration. It is written in the style of literate
programming, which means, in this case, that it&rsquo;s written in Org-mode. Perhaps
unlike other Emacs configurations written in Org, however, it is written in a
non-linear fashion. That means that source code is presented in a way that&rsquo;s
suitable for the <i>documenting</i> of code, and not the running of code. If you
copied all source blocks in this document and put them in the same order in an
Emacs configuration file, it might not work.
</p>
</div>

<div id="outline-container-org0a074d1" class="outline-3">
<h3 id="org0a074d1"><span class="section-number-3">1.1</span> &ldquo;Best of&rdquo;</h3>
<div class="outline-text-3" id="text-1-1">
<p>
My Emacs configuration is very long. I understand if nobody will ever read
it all, but I do think there are parts of it <i>worth</i> reading. Following is a list
of quick links to the most interesting sections of this document.
</p>

<dl class="org-dl">
<dt><a href="#org-tree-view">org-tree-view</a></dt><dd>A sidebar for conveniently browsing all the headings in an
Org document. The resulting package is as interesting, I would say, as some
of the underlying code.</dd>
</dl>
</div>
</div>
</div>


<div id="outline-container-org38d2e9a" class="outline-2">
<h2 id="org38d2e9a"><span class="section-number-2">2</span> Packages</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-orgfc3329b" class="outline-3">
<h3 id="orgfc3329b"><span class="section-number-3">2.1</span> Package management</h3>
<div class="outline-text-3" id="text-2-1">
<p>
First and foremost, I define what sources to install packages from:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org18b65ba"><span style="color: #458588;">(</span><span style="color: #fb4934;">require</span> '<span style="color: #d3869b;">package</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">setq</span> package-archives
      '<span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"gnu"</span> . <span style="color: #b8bb26;">"http://elpa.gnu.org/packages/"</span><span style="color: #8ec07c;">)</span>
        <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"org"</span> . <span style="color: #b8bb26;">"http://orgmode.org/elpa/"</span><span style="color: #8ec07c;">)</span>
        <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"melpa"</span> . <span style="color: #b8bb26;">"http://melpa.org/packages/"</span><span style="color: #8ec07c;">)</span>
        <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"melpa-stable"</span> . <span style="color: #b8bb26;">"http://stable.melpa.org/packages/"</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">setq</span> package-archive-priorities
      '<span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"melpa-stable"</span> . 1<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>package-initialize<span style="color: #458588;">)</span>
</pre>
</div>

<p>
I call <code>package-initialize</code> here, because I want all installed packages to be
loaded automatically with their default configuration, <i>except</i> the ones I
explicitly configure with <code>use-package</code>.
</p>

<p>
For that I initialize <i>use-package</i>:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org90ea43a"><span style="color: #458588;">(</span><span style="color: #fb4934;">eval-when-compile</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">require</span> '<span style="color: #d3869b;">use-package</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">require</span> '<span style="color: #d3869b;">diminish</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">if you use :diminish</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">require</span> '<span style="color: #d3869b;">bind-key</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">if you use any :bind variant</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d4a8ae" class="outline-3">
<h3 id="org8d4a8ae"><span class="section-number-3">2.2</span> List of packages</h3>
<div class="outline-text-3" id="text-2-2">
<p>
As I&rsquo;ve said, this document is presented in a non-linear way. Under this rubric,
I list all the packages that I have installed and that I use. However, their
respective configurations are listed elsewhere.
</p>
</div>

<div id="outline-container-org4c7ab7b" class="outline-4">
<h4 id="org4c7ab7b">Packages with configuration elsewhere</h4>
<div class="outline-text-4" id="text-org4c7ab7b">
<ul class="org-ul">
<li><a href="#multiple-cursors">multiple-cursors</a></li>
<li><a href="#visual-regexp">visual-regexp</a></li>
<li><a href="#expand-region">expand-region</a></li>
<li><a href="#paredit">paredit</a></li>
<li><a href="#iy-go-to-char">iy-go-to-char</a></li>
<li><a href="#avy">avy</a></li>
<li><a href="#origami">origami</a></li>
<li><a href="#helm">helm</a></li>
<li><a href="#projectile">projectile</a></li>
<li><a href="#magit">magit</a></li>
<li><a href="#git-gutter">git-gutter+</a></li>
<li><a href="#openwith">openwith</a></li>
<li><a href="#org-mode">org-mode</a></li>
</ul>
</div>
</div>

<div id="outline-container-org5049152" class="outline-4">
<h4 id="org5049152">Packages without interesting configuration</h4>
<div class="outline-text-4" id="text-org5049152">
<p>
In order to do their job, some packages have to be explicitly enabled in the
Emacs configuration, but do not need to be further configured. For that reason,
I probably won&rsquo;t mention these packages elsewhere, and instead just list them
here with a short description of why I like them.
</p>

<dl class="org-dl">
<dt>rainbow-delimiters</dt><dd>Paints matching parentheses with the same color.</dd>

<dt>ace-link</dt><dd>Nice little extension to <i>avy</i> that does the same thing, but for
links in help buffers.</dd>

<dt>popwin</dt><dd>Makes popup windows <i>so</i> much easier to work with - this is a
must-have.</dd>

<dt>helm-org-rifle</dt><dd>Makes it <i>a bit</i> easier to browse through Org documents - not
perfect though.</dd>

<dt>buffer-move</dt><dd>Lets me switch buffers between two windows - pretty handy.</dd>
</dl>
</div>
</div>
</div>
</div>

<div id="outline-container-org54dc0a3" class="outline-2">
<h2 id="basic-preferences"><a id="org54dc0a3"></a><span class="section-number-2">3</span> Basic preferences</h2>
<div class="outline-text-2" id="text-basic-preferences">
<p>
In my configuration, there are some basic settings that don&rsquo;t really belong
under any section in this documentation. Most of them are set using the
<i>Customize</i> interface, but here are the ones that aren&rsquo;t:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgeb7f69b"><span style="color: #458588;">(</span>server-start<span style="color: #458588;">)</span>         <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">use emacs as a server</span>
<span style="color: #458588;">(</span>electric-pair-mode 1<span style="color: #458588;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">auto-insert matching pairs</span>
<span style="color: #458588;">(</span>menu-bar-mode -1<span style="color: #458588;">)</span>     <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">disable menu bar</span>
<span style="color: #458588;">(</span>tool-bar-mode -1<span style="color: #458588;">)</span>     <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">disable gui toolbar</span>
<span style="color: #458588;">(</span>save-place-mode 1<span style="color: #458588;">)</span>    <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">save cursor position</span>
<span style="color: #458588;">(</span>xterm-mouse-mode t<span style="color: #458588;">)</span>   <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">use mouse (somewhat effectively) in terminal</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Activate auto-fill-mode for all text buffers</span>
<span style="color: #458588;">(</span>add-hook 'text-mode-hook 'turn-on-auto-fill<span style="color: #458588;">)</span>
</pre>
</div>
</div>

<div id="outline-container-orgc06575c" class="outline-3">
<h3 id="directories"><a id="orgc06575c"></a><span class="section-number-3">3.1</span> Directories</h3>
<div class="outline-text-3" id="text-directories">
<p>
Per default, Emacs insists on making a mess inside <code>~/.emacs.d</code>. These settings
prevent that.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org4e47dd4"><span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> custom-file <span style="color: #b16286;">(</span>concat user-emacs-directory <span style="color: #b8bb26;">"custom.el"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> emacs-state-directory <span style="color: #b16286;">(</span>expand-file-name <span style="color: #b8bb26;">"state/"</span> user-emacs-directory<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">state-dir</span> <span style="color: #b16286;">(</span>file<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>concat emacs-state-directory file<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">- Various places</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> auto-save-list-file-prefix   <span style="color: #b16286;">(</span>state-dir <span style="color: #b8bb26;">"auto-save-list/.saves~"</span><span style="color: #b16286;">)</span>
      save-place-file              <span style="color: #b16286;">(</span>state-dir <span style="color: #b8bb26;">"save-place"</span><span style="color: #b16286;">)</span>
      recentf-save-file            <span style="color: #b16286;">(</span>state-dir <span style="color: #b8bb26;">"recentf"</span><span style="color: #b16286;">)</span>
      ido-save-directory-list-file <span style="color: #b16286;">(</span>state-dir <span style="color: #b8bb26;">"ido.last"</span><span style="color: #b16286;">)</span>
      eshell-directory-name        <span style="color: #b16286;">(</span>state-dir <span style="color: #b8bb26;">"eshell"</span><span style="color: #b16286;">)</span>
      nsm-settings-file            <span style="color: #b16286;">(</span>state-dir <span style="color: #b8bb26;">"network-security.data"</span><span style="color: #b16286;">)</span>
      backup-directory-alist       `<span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">".*"</span> . ,<span style="color: #d65d0e;">(</span>state-dir <span style="color: #b8bb26;">"saves"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">- Tramp</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> tramp-backup-directory-alist backup-directory-alist<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> tramp-auto-save-directory <span style="color: #b16286;">(</span>state-dir
                                        <span style="color: #b8bb26;">"tramp/auto-save/"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> tramp-persistency-file-name <span style="color: #b16286;">(</span>state-dir
                                          <span style="color: #b8bb26;">"tramp/persistency.el"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">- Projectile</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> projectile-cache-file <span style="color: #b16286;">(</span>concat emacs-state-directory
                                    <span style="color: #b8bb26;">"projectile/cache.el"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> projectile-known-projects-file
      <span style="color: #b16286;">(</span>concat emacs-state-directory
              <span style="color: #b8bb26;">"projectile/known-projects.el"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">- File for activated disabled commands</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">defadvice</span> <span style="color: #fabd2f;">en/disable-command</span> <span style="color: #b16286;">(</span>around put-in-custom-file activate<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Put declarations in `</span><span style="color: #d3869b;">custom-file</span><span style="color: #b8bb26;">'."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>user-init-file <span style="color: #458588;">(</span>concat user-emacs-directory <span style="color: #b8bb26;">".commands"</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    ad-do-it<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>load-file <span style="color: #b16286;">(</span>concat user-emacs-directory <span style="color: #b8bb26;">".commands"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org419cdff" class="outline-3">
<h3 id="keybindings"><a id="org419cdff"></a><span class="section-number-3">3.2</span> Keybindings</h3>
<div class="outline-text-3" id="text-keybindings">
<p>
Here are a couple of keybindings that don&rsquo;t really fit in under any other
headline. Most of them are based on built-in functions.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org1f94e70"><span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"M-&lt;f1&gt;"</span><span style="color: #b16286;">)</span> #'menu-bar-mode<span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"M-]"</span><span style="color: #b16286;">)</span> #'other-window<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"M-["</span><span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">(</span>n<span style="color: #8ec07c;">)</span>
                              <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"p"</span><span style="color: #8ec07c;">)</span>
                              <span style="color: #8ec07c;">(</span>other-window <span style="color: #d65d0e;">(</span>* -1 n<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"&lt;S-home&gt;"</span><span style="color: #b16286;">)</span> #'previous-buffer<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"&lt;S-end&gt;"</span><span style="color: #b16286;">)</span> #'next-buffer<span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"C-h C-t"</span><span style="color: #b16286;">)</span> #'toggle-debug-on-error<span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"M-n"</span><span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">(</span>n<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"p"</span><span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>scroll-up n<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"M-p"</span><span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">(</span>n<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"p"</span><span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>scroll-down n<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Use for other modes too</span>
<span style="color: #458588;">(</span>define-key Info-mode-map    <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"M-n"</span><span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>lookup-key global-map <span style="color: #8ec07c;">(</span>kbd <span style="color: #b8bb26;">"M-n"</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>define-key Info-mode-map    <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"M-p"</span><span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>lookup-key global-map <span style="color: #8ec07c;">(</span>kbd <span style="color: #b8bb26;">"M-p"</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>add-hook 'message-mode-hook
      <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span>
        <span style="color: #8ec07c;">(</span>define-key message-mode-map <span style="color: #d65d0e;">(</span>kbd <span style="color: #b8bb26;">"M-n"</span><span style="color: #d65d0e;">)</span> <span style="color: #d65d0e;">(</span>lookup-key global-map <span style="color: #458588;">(</span>kbd <span style="color: #b8bb26;">"M-n"</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"&lt;C-tab&gt;"</span><span style="color: #b16286;">)</span> #'completion-at-point<span style="color: #458588;">)</span>
</pre>
</div>

<p>
Apart from defining new ones, there are some keybindings that I remove. One
problematic keybinding is <code>C-z</code>. It suspends Emacs - useful in terminals, annoying
in the graphical version of Emacs. The following code disables that keybinding
for GUI Emacs, but keeps it for <code>emacs -nw</code> and <code>emacsclient -t</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org50da68a"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">suspend-frame-unless-gui</span> <span style="color: #b16286;">(</span>oldfun <span style="color: #d3869b;">&amp;rest</span> r<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">unless</span> <span style="color: #8ec07c;">(</span>display-graphic-p<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>apply oldfun r<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>advice-add #'suspend-frame <span style="color: #fe8019;">:around</span> #'suspend-frame-unless-gui<span style="color: #458588;">)</span>
</pre>
</div>

<p>
It&rsquo;s not strictly a keybinding, but I still felt it belonged in this section.
</p>
</div>
</div>

<div id="outline-container-orgf487542" class="outline-3">
<h3 id="functions"><a id="orgf487542"></a><span class="section-number-3">3.3</span> Helper functions</h3>
<div class="outline-text-3" id="text-functions">
<p>
Here is a collection of useful helper functions that I use in my Emacs
configuration.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org1f682bf"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">delete-and-extract-comment</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> bol-arg<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Delete and return the comment at the end of the line. If there</span>
<span style="color: #b8bb26;">is no comment, return nil."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span>comment<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">save-excursion</span>
      <span style="color: #d65d0e;">(</span>move-beginning-of-line <span style="color: #458588;">(</span><span style="color: #fb4934;">or</span> bol-arg 1<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">when</span> <span style="color: #458588;">(</span>skip-syntax-forward <span style="color: #b8bb26;">"^&lt;"</span> <span style="color: #b16286;">(</span>point-at-eol<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span><span style="color: #fb4934;">setq</span> comment <span style="color: #b16286;">(</span>delete-and-extract-region <span style="color: #8ec07c;">(</span>point<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>point-at-eol<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span>delete-horizontal-space<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span>string-equal <span style="color: #b8bb26;">""</span> comment<span style="color: #d65d0e;">)</span> nil comment<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defmacro</span> <span style="color: #fabd2f;">--fcase</span> <span style="color: #b16286;">(</span>form <span style="color: #d3869b;">&amp;rest</span> arg-then<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"For each `</span><span style="color: #d3869b;">arg-then</span><span style="color: #b8bb26;">', evaluate `</span><span style="color: #d3869b;">form</span><span style="color: #b8bb26;">' with the car of</span>
<span style="color: #b8bb26;">`</span><span style="color: #d3869b;">arg-then</span><span style="color: #b8bb26;">' exposed as `</span><span style="color: #d3869b;">it</span><span style="color: #b8bb26;">'. For the first `</span><span style="color: #d3869b;">arg-then</span><span style="color: #b8bb26;">' for which</span>
<span style="color: #b8bb26;">the evaluation of `</span><span style="color: #d3869b;">form</span><span style="color: #b8bb26;">' returns true, evaluate and return then</span>
<span style="color: #b8bb26;">cdr of `</span><span style="color: #d3869b;">arg-then</span><span style="color: #b8bb26;">'.</span>

<span style="color: #b8bb26;">If the car of `</span><span style="color: #d3869b;">arg-then</span><span style="color: #b8bb26;">' is `</span><span style="color: #d3869b;">else</span><span style="color: #b8bb26;">', its cdr will be always be</span>
<span style="color: #b8bb26;">evaluated, if no `</span><span style="color: #d3869b;">arg-then</span><span style="color: #b8bb26;">' before has resulted in a true</span>
<span style="color: #b8bb26;">evaluation of `</span><span style="color: #d3869b;">form</span><span style="color: #b8bb26;">'.</span>

<span style="color: #b8bb26;">   (--fcase (string-prefix-p it my-string)</span>
<span style="color: #b8bb26;">            (\"prefix-\"       (message \"Prefix: prefix-\"))</span>
<span style="color: #b8bb26;">            (\"other-prefix-\" (message \"Prefix: other-prefix-\"))</span>
<span style="color: #b8bb26;">            (else              (message \"No prefix\")))"</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">declare</span> <span style="color: #8ec07c;">(</span>debug <span style="color: #d65d0e;">(</span>form form arg-then form<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  `<span style="color: #b16286;">(</span><span style="color: #fb4934;">cl-loop</span>
      for it-then in ',arg-then
      do <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>it   <span style="color: #b16286;">(</span>car it-then<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
               <span style="color: #458588;">(</span>then <span style="color: #b16286;">(</span>cdr it-then<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
           <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">unless</span> <span style="color: #458588;">(</span>eq it 'else<span style="color: #458588;">)</span> <span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> it <span style="color: #b16286;">(</span>eval it<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
           <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span><span style="color: #fb4934;">or</span> <span style="color: #b16286;">(</span>eq it 'else<span style="color: #b16286;">)</span> ,form<span style="color: #458588;">)</span>
               <span style="color: #458588;">(</span><span style="color: #fb4934;">cl-return</span>
                 <span style="color: #b16286;">(</span>car <span style="color: #8ec07c;">(</span>last <span style="color: #d65d0e;">(</span>mapcar
                             <span style="color: #458588;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #458588;">(</span>exp<span style="color: #458588;">)</span> <span style="color: #458588;">(</span>eval exp<span style="color: #458588;">)</span><span style="color: #458588;">)</span>
                             then<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org475d8e1" class="outline-3">
<h3 id="session-management"><a id="org475d8e1"></a><span class="section-number-3">3.4</span> Session management</h3>
<div class="outline-text-3" id="text-session-management">
<p>
If there is a way to save the current window configuration to a file, and I mean
<i>only</i> the window configuration (and, of course, the buffers that are open in
those windows), <b>please tell me</b>.
</p>

<p>
For the moment, I use <code>desktop-save-mode</code>, but I&rsquo;m unhappy. It saves far too many
irrelevant things, like the theme I&rsquo;m using and all buffers. I only want to
save the currently visible buffers and the positions of their windows. That&rsquo;s
it.
</p>

<p>
In the meantime, this is my configuration for <code>desktop-save-mode</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org6eba9ed"><span style="color: #458588;">(</span><span style="color: #fb4934;">setq</span> desktop-dirname             <span style="color: #b16286;">(</span>concat emacs-state-directory <span style="color: #b8bb26;">"desktop/"</span><span style="color: #b16286;">)</span>
      desktop-base-file-name      <span style="color: #b8bb26;">"emacs.desktop"</span>
      desktop-base-lock-name      <span style="color: #b8bb26;">"lock"</span>
      desktop-path                <span style="color: #b16286;">(</span>list desktop-dirname<span style="color: #b16286;">)</span>
      desktop-save                t<span style="color: #458588;">)</span>
</pre>
</div>

<p>
Furthrmore, I have a custom function that lets me easily activate the mode:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org9db3fc4"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">init-desktop</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> arg<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Load the desktop (if C-u is provided) and enable autosaving."</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"p"</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> current-prefix-arg <span style="color: #8ec07c;">(</span>desktop-read<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>desktop-save-mode 1<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>message <span style="color: #b8bb26;">"Desktop-Save mode enabled"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"C-c D"</span><span style="color: #b16286;">)</span> 'init-desktop<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org133b99f" class="outline-3">
<h3 id="org133b99f"><span class="section-number-3">3.5</span> Shebang mode detection</h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org35060c0"><span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Shebang mode detection</span>
<span style="color: #458588;">(</span>add-to-list 'interpreter-mode-alist
             '<span style="color: #b16286;">(</span><span style="color: #b8bb26;">"python3"</span> . python-mode<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org1863e10" class="outline-2">
<h2 id="org1863e10"><span class="section-number-2">4</span> Text editing</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-orgad83052" class="outline-3">
<h3 id="multiple-cursors"><a id="orgad83052"></a><span class="section-number-3">4.1</span> Multiple cursors</h3>
<div class="outline-text-3" id="text-multiple-cursors">
<p>
<code>multiple-cursors</code> is another indispensible part of my Emacs toolchain. This is
mostly a configuration of keys, but I also add <code>iy-go-to-char-start-pos</code> to the
<code>mc/cursor-specific-vars</code> list. This was recommended to me. The cursor specific
variables are, according to the <code>multiple-cursors</code> source, &ldquo;a list of vars that
need to be tracked on a per-cursor basis.&rdquo;
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org3848c31"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> multiple-cursors
  <span style="color: #fe8019;">:config</span>
  <span style="color: #b16286;">(</span>add-to-list 'mc/cursor-specific-vars 'iy-go-to-char-start-pos<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defhydra</span> multiple-cursors-hydra <span style="color: #8ec07c;">(</span><span style="color: #fe8019;">:hint</span> nil<span style="color: #8ec07c;">)</span>
    <span style="color: #b8bb26;">"</span>
<span style="color: #b8bb26;">      ^Up^            ^Down^        ^Other^</span>
<span style="color: #b8bb26;"> ----------------------------------------------</span>
<span style="color: #b8bb26;"> [_p_]   Next    [_n_]   Next    [_/_] Edit lines</span>
<span style="color: #b8bb26;"> [_P_]   Skip    [_N_]   Skip    [_?_] Mark all</span>
<span style="color: #b8bb26;"> [_M-p_] Unmark  [_M-n_] Unmark  [_r_] Mark by regexp</span>
<span style="color: #b8bb26;"> ^ ^             ^ ^             [_a_] Align</span>
<span style="color: #b8bb26;"> ^ ^             ^ ^             [_q_] Quit</span>
<span style="color: #b8bb26;">"</span>
    <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"/"</span>   mc/edit-lines <span style="color: #fe8019;">:exit</span> t<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"?"</span>   mc/mark-all-like-this<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"n"</span>   mc/mark-next-like-this<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"N"</span>   mc/skip-to-next-like-this<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-n"</span> mc/unmark-next-like-this<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"p"</span>   mc/mark-previous-like-this<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"P"</span>   mc/skip-to-previous-like-this<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-p"</span> mc/unmark-previous-like-this<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"r"</span>   mc/mark-all-in-region-regexp<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"a"</span>   mc/vertical-align-with-space <span style="color: #fe8019;">:exit</span> t<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"q"</span>   nil<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">with-eval-after-load</span> 'undo-tree
    <span style="color: #8ec07c;">(</span>define-key undo-tree-map <span style="color: #d65d0e;">(</span>kbd <span style="color: #b8bb26;">"C-/"</span><span style="color: #d65d0e;">)</span> nil<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>define-key undo-tree-map <span style="color: #d65d0e;">(</span>kbd <span style="color: #b8bb26;">"C-?"</span><span style="color: #d65d0e;">)</span> nil<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>global-set-key <span style="color: #8ec07c;">(</span>kbd <span style="color: #b8bb26;">"C-/"</span><span style="color: #8ec07c;">)</span> 'multiple-cursors-hydra/body<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
For a good and easy-to-reproduce example of how powerful <code>multiple-cursors</code>
really is, go to the buffer list (<code>M-x</code> <code>list-buffers</code>). Let&rsquo;s say you have
multiple Magit buffers open that you want to kill.
</p>

<p>
Search your way to the first Magit buffer, highlight the <code>*magit-</code> prefix,
and run <code>mc/mark-all-like-this</code>. Now you have a cursor on every Magit
buffer in the list. Now you can type <code>k</code> to mark every buffer with a cursor
on it for deletion. After disabling your multiple cursors with <code>C-g</code>, you
can finally press <code>x</code> to make the buffer menu execute your instructions and
delete all Magit buffers.
</p>

<p>
Of course, this particular task is more easily done using a function like
<code>kill-matching-buffers</code> or even the Helm buffers list, but the routine
described above clearly illustrates the power of having multiple cursors.
</p>
</div>
</div>

<div id="outline-container-orga0dd952" class="outline-3">
<h3 id="visual-regexp"><a id="orga0dd952"></a><span class="section-number-3">4.2</span> Search &amp; replace: <i>visual-regexp</i></h3>
<div class="outline-text-3" id="text-visual-regexp">
<p>
<b>visual-regexp</b> is certainly worth a spot on the &ldquo;interesting&rdquo; packages list, not
only because its configuration is special, but because it is <i>just so good</i>. Not
only does it provide an incremental regex replace function - that means live
preview (!) - but the extension <b>visual-regexp-steroids</b> lets you search and
replace using PCRE instead of Emacs syntax (!).
</p>

<p>
To get this working with <code>use-package</code>, I first configure the plain old
<i>visual-regexp</i> package, but tell <code>use-package</code> to <i>defer</i> its loading - you see, for
<i>visual-regexp-steroids</i> to work, it seems as though it needs to load
<i>visual-regexp</i> itself. If you load it beforehand, it won&rsquo;t work.
</p>

<p>
Because <code>use-package</code> enables lazy-loading of packages when their configuration
includes a <code>:bind</code> option, we have to explicitly tell it to load
<i>visual-regexp-steroids</i> immediately, regardless of the <i>:bind</i>-clause. This, again,
so that <i>visual-regexp</i> won&rsquo;t load before its muscly brother.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org3216a14"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> visual-regexp
  <span style="color: #fe8019;">:defer</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">prevent loading this package before visual-regexp-steroids!</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> visual-regexp-steroids
  <span style="color: #fe8019;">:ensure</span> pcre2el <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">much faster than Python</span>
  <span style="color: #fe8019;">:demand</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">load this package immediately, regardless of :bind</span>
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c r"</span> . vr/replace<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c q"</span> . vr/query-replace<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c m"</span> . vr/mc-mark<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-M-r"</span> . vr/isearch-backward<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-M-s"</span> . vr/isearch-forward<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #fe8019;">:config</span> <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> vr/engine 'pcre2el<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
I got this solution from <a href="https://github.com/benma/visual-regexp-steroids.el/issues/16#issue-123951566">a workaround</a> posted by GitHub user <i>alamaison</i>.
Thank you!
</p>

<p>
To enable PCRE style regex, instead of the default Python style, I configure the
package to use <i>pcre2el</i> as its engine.
</p>

<p>
An interesting function provided by <i>visual-regexp</i> is <code>vr/mc-mark</code>. This
function integrates with the <i>multiple-cursors</i> package to add a cursor to
every match to a regex search. Useful!
</p>
</div>
</div>

<div id="outline-container-org656be56" class="outline-3">
<h3 id="alignment"><a id="org656be56"></a><span class="section-number-3">4.3</span> Alignment</h3>
<div class="outline-text-3" id="text-alignment">
</div>

<div id="outline-container-org3c269fe" class="outline-4">
<h4 id="org3c269fe">Aligning comments</h4>
<div class="outline-text-4" id="text-org3c269fe">
<p>
What follows is a function <a href="http://stackoverflow.com/a/20278032/305047">written by the user phils</a> at StackOverflow. It is a
language-agnostic method of aligning comments. How useful!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orge93620d"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">align-comments-in-region</span> <span style="color: #b16286;">(</span>beginning end<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Align comments within marked region."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"*r"</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span>indent-tabs-mode align-to-tab-stop<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>align-regexp beginning end <span style="color: #d65d0e;">(</span>concat <span style="color: #b8bb26;">"</span><span style="color: #b8bb26; font-weight: bold;">\\</span><span style="color: #b8bb26; font-weight: bold;">(</span><span style="color: #b8bb26;">\\s-*</span><span style="color: #b8bb26; font-weight: bold;">\\</span><span style="color: #b8bb26; font-weight: bold;">)</span><span style="color: #b8bb26;">"</span>
                                        <span style="color: #458588;">(</span>regexp-quote comment-start<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"C-c M-a"</span><span style="color: #b16286;">)</span> #'align-comments-in-region<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org401905e" class="outline-3">
<h3 id="lisp"><a id="org401905e"></a><span class="section-number-3">4.4</span> Working with Lisp</h3>
<div class="outline-text-3" id="text-lisp">
</div>

<div id="outline-container-orga32668c" class="outline-4">
<h4 id="paredit"><a id="orga32668c"></a>Paredit</h4>
<div class="outline-text-4" id="text-paredit">
<p>
Paredit is a totally indispensible tool for editing Lisp code. It changes the
way you write Lisp, by replacing many built-in editing commands as well as
providing its own set of functions, for creating, re-arranging, splitting,
convoluting and deleting s-expressions.
</p>

<p>
My only problem with Paredit is that it replaces <code>M-r</code>. I frequently use <code>M-r</code> to
quickly move the cursor around the screen, but Paredit overrides that keybinding
with <code>paredit-raise-sexp</code>. To fix this, as you can see below, I have created a new
keybinding, <code>M-R</code>, and put it inside a <code>use-package</code> <i>:bind</i>-clause. This way, as long
as I have Paredit installed, <code>use-package</code> binds <code>M-R</code> to the original function of
<code>M-r</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org7db4192"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> paredit
  <span style="color: #fe8019;">:init</span>
  <span style="color: #b16286;">(</span>autoload 'enable-paredit-mode
      <span style="color: #b8bb26;">"paredit"</span> <span style="color: #b8bb26;">"Turn on pseudo-structural editing of Lisp code."</span> t<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'emacs-lisp-mode-hook       #'enable-paredit-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'eval-expression-minibuffer-setup-hook #'enable-paredit-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'ielm-mode-hook             #'enable-paredit-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'lisp-mode-hook             #'enable-paredit-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'lisp-interaction-mode-hook #'enable-paredit-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'scheme-mode-hook           #'enable-paredit-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'racket-mode-hook           #'enable-paredit-mode<span style="color: #b16286;">)</span>

  <span style="color: #fe8019;">:config</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">paredit-delete-indentation</span> <span style="color: #8ec07c;">(</span><span style="color: #d3869b;">&amp;optional</span> arg<span style="color: #8ec07c;">)</span>
    <span style="color: #b8bb26;">"Handle joining lines that end in a comment."</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"*P"</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>comment <span style="color: #b16286;">(</span>delete-and-extract-comment <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> arg 1 0<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>delete-indentation arg<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">when</span> comment
        <span style="color: #458588;">(</span><span style="color: #fb4934;">save-excursion</span>
          <span style="color: #b16286;">(</span>move-end-of-line 1<span style="color: #b16286;">)</span>
          <span style="color: #b16286;">(</span>insert <span style="color: #b8bb26;">" "</span><span style="color: #b16286;">)</span>
          <span style="color: #b16286;">(</span>insert comment<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">paredit-newline-keep-comment</span> <span style="color: #8ec07c;">(</span><span style="color: #d3869b;">&amp;optional</span> arg<span style="color: #8ec07c;">)</span>
    <span style="color: #b8bb26;">"Insert newline, but keep any potential comment on the</span>
<span style="color: #b8bb26;">current line."</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"*P"</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>comment <span style="color: #b16286;">(</span>delete-and-extract-comment<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>paredit-newline<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">when</span> comment
        <span style="color: #458588;">(</span><span style="color: #fb4934;">save-excursion</span>
          <span style="color: #b16286;">(</span>forward-line -1<span style="color: #b16286;">)</span>
          <span style="color: #b16286;">(</span>move-end-of-line 1<span style="color: #b16286;">)</span>
          <span style="color: #b16286;">(</span>insert <span style="color: #b8bb26;">" "</span><span style="color: #b16286;">)</span>
          <span style="color: #b16286;">(</span>insert comment<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span>global-set-key <span style="color: #8ec07c;">[</span>remap paredit-newline<span style="color: #8ec07c;">]</span> #'paredit-newline-keep-comment<span style="color: #b16286;">)</span>

  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Disable comment column</span>
  <span style="color: #b16286;">(</span>add-hook 'paredit-mode-hook <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #d65d0e;">()</span> <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">setq-local</span> comment-column 0<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Disable keybindings already used</span>
  <span style="color: #b16286;">(</span>define-key paredit-mode-map <span style="color: #8ec07c;">(</span>kbd <span style="color: #b8bb26;">"M-q"</span><span style="color: #8ec07c;">)</span> nil<span style="color: #b16286;">)</span>

  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-R"</span> . move-to-window-line-top-bottom<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-^"</span> . paredit-delete-indentation<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-Q"</span> . paredit-reindent-defun<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org39d8dc6" class="outline-4">
<h4 id="aggressive-indent"><a id="org39d8dc6"></a>Aggressive indentation</h4>
<div class="outline-text-4" id="text-aggressive-indent">
<p>
<code>aggressive-indent</code> is a package that makes Emacs indent all the things, all the
time. I personally only use it for Lisp modes.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgf56766c"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> aggressive-indent
  <span style="color: #fe8019;">:demand</span>
  <span style="color: #fe8019;">:init</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">enable-aggressive-indent-mode</span> <span style="color: #8ec07c;">()</span>
    <span style="color: #8ec07c;">(</span>aggressive-indent-mode<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'emacs-lisp-mode-hook       #'enable-aggressive-indent-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'eval-expression-minibuffer-setup-hook #'enable-aggressive-indent-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'ielm-mode-hook             #'enable-aggressive-indent-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'lisp-mode-hook             #'enable-aggressive-indent-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'lisp-interaction-mode-hook #'enable-aggressive-indent-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'scheme-mode-hook           #'enable-aggressive-indent-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'racket-mode-hook           #'enable-aggressive-indent-mode<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org26336ba" class="outline-4">
<h4 id="common-lisp-indent"><a id="org26336ba"></a>Common Lisp indentation</h4>
<div class="outline-text-4" id="text-common-lisp-indent">
<p>
I like using the <code>cl-lib</code> library, which adds a whole bunch of Common Lisp
functions, prefixed with <i>cl-</i>. Unfortunately, Emacs doesn&rsquo;t indent some of the
<i>cl-</i> functions correctly. For that reason, I use the <code>common-lisp-indent-function</code>
instead of the normal <code>lisp-indent-function</code>.
</p>

<p>
This might break a few things, though. For me, it broke <code>use-package</code> intentation.
Luckily, you can change the indentation rules yourself, as demonstrated below.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga49f6ac"><span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> lisp-indent-function 'common-lisp-indent-function<span style="color: #458588;">)</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Fix custom indentation</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">with-eval-after-load</span> <span style="color: #b8bb26;">"cl-indent"</span>
  <span style="color: #b16286;">(</span>put 'use-package 'common-lisp-indent-function 1<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>put 'use-package-as-one 'common-lisp-indent-function 1<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf2b0d1d" class="outline-3">
<h3 id="regions"><a id="orgf2b0d1d"></a><span class="section-number-3">4.5</span> Working with regions</h3>
<div class="outline-text-3" id="text-regions">
</div>

<div id="outline-container-org8f84eb5" class="outline-4">
<h4 id="expand-region"><a id="org8f84eb5"></a><i>expand-region</i></h4>
<div class="outline-text-4" id="text-expand-region">
<p>
I spend a lot of space setting up the shortcuts for <code>expand-region</code>, because
it is very useful. The functions speak for themselves. I use many of them, as
I find <code>er/expand-region</code> to work somewhat poorly with Emacs Lisp - perhaps
Paredit interferes with it.
</p>

<p>
In my configuration, I use <code>C-'</code> as a prefix for all <code>expand-region</code>
keybindings, and <i>Shift</i> as a modifier to mark outside instead of inside the
region.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org665ee1f"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> expand-region
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-' r"</span>  . er/expand-region<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-' w"</span>  . er/mark-word<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-' '"</span>  . er/mark-inside-quotes<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-' \""</span> . er/mark-outside-quotes<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-' p"</span>  . er/mark-inside-pairs<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-' P"</span>  . er/mark-outside-pairs<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-' c"</span>  . er/mark-comment<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-' t"</span>  . er/mark-inner-tag<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-' T"</span>  . er/mark-outer-tag<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-' f"</span>  . er/mark-defun<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf343cf6" class="outline-4">
<h4 id="wrap-region"><a id="orgf343cf6"></a><i>wrap-region</i></h4>
<div class="outline-text-4" id="text-wrap-region">
<p>
<code>wrap-region</code> is a handy plugin that automatically surrounds your selection with the
corresponding pairs when typing &ldquo;paired&rdquo; characters, like <code>'</code>, <code>"</code> and <code>(</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-org38a8912" class="outline-3">
<h3 id="smart-open-line"><a id="org38a8912"></a><span class="section-number-3">4.6</span> Opening line below and above</h3>
<div class="outline-text-3" id="text-smart-open-line">
<p>
Every Vim user knows how useful the <code>o</code> and <code>O</code> commands are. <code>smart-open-line</code> and
<code>smart-open-line-above</code> are two functions, borrowed from Emacs Redux, that emulate
this behavior.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org8349e5c"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">smart-open-line</span> <span style="color: #b16286;">()</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">(courtesy of Emacs Redux)</span>
  <span style="color: #b8bb26;">"Insert an empty line after the current line.</span>
<span style="color: #b8bb26;">Position the cursor at beginning, according to current mode."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>move-end-of-line nil<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>newline-and-indent<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">smart-open-line-above</span> <span style="color: #b16286;">()</span>
  <span style="color: #b8bb26;">"Insert an empty line above the current line.</span>
<span style="color: #b8bb26;">Position the cursor at beginning, according to current mode."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>move-beginning-of-line nil<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>newline<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span>looking-at <span style="color: #b8bb26;">"[[:space:]]*$"</span><span style="color: #8ec07c;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">remove indentation from old line</span>
      <span style="color: #8ec07c;">(</span>delete-horizontal-space<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>forward-line -1<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>indent-according-to-mode<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
Personally, I use the following keybindings:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgadfb940"><span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"M-o"</span><span style="color: #b16286;">)</span> 'smart-open-line<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"M-O"</span><span style="color: #b16286;">)</span> 'smart-open-line-above<span style="color: #458588;">)</span>
</pre>
</div>

<p>
Note, however, that if you use Emacs in a terminal, <code>M-O</code> will not work.
</p>
</div>
</div>

<div id="outline-container-orga216497" class="outline-3">
<h3 id="commenting-lines"><a id="orga216497"></a><span class="section-number-3">4.7</span> Commenting lines</h3>
<div class="outline-text-3" id="text-commenting-lines">
<p>
What follows is a function by Jason Viers at StackExchange. It makes it a bit
easier to comment either the current line or the current region.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org01cd439"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">comment-dwim-line</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> arg<span style="color: #b16286;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">(courtesy of Jason Viers @ SE)</span>
  <span style="color: #b8bb26;">"Replacement for the comment-dwim command.</span>
<span style="color: #b8bb26;">If no region is selected and current line is not blank and we are</span>
<span style="color: #b8bb26;">not at the end of the line, then comment current line. Replaces</span>
<span style="color: #b8bb26;">default behaviour of comment-dwim, when it inserts comment at the</span>
<span style="color: #b8bb26;">end of the line."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"*P"</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>comment-normalize-vars<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">and</span> <span style="color: #d65d0e;">(</span>not <span style="color: #458588;">(</span>region-active-p<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span> <span style="color: #d65d0e;">(</span>not <span style="color: #458588;">(</span>looking-at <span style="color: #b8bb26;">"[ \t]*$"</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
      <span style="color: #8ec07c;">(</span>comment-or-uncomment-region <span style="color: #d65d0e;">(</span>line-beginning-position<span style="color: #d65d0e;">)</span>
                                   <span style="color: #d65d0e;">(</span>line-end-position<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>comment-dwim arg<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"C-;"</span><span style="color: #b16286;">)</span> 'comment-dwim-line<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org746b3f6" class="outline-2">
<h2 id="org746b3f6"><span class="section-number-2">5</span> Movement</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-orgae6341e" class="outline-3">
<h3 id="jumping"><a id="orgae6341e"></a><span class="section-number-3">5.1</span> Quickly jumping around</h3>
<div class="outline-text-3" id="text-jumping">
<p>
Moving around using <code>C-n</code>, <code>C-p</code>, <code>C-f</code> and <code>C-b</code> is not only tiresome, but
probably quite <a href="#rsi">unergonomical</a> as well. Under this section, I tell you about the
methods I use to quickly jump to any position in the current window.
</p>
</div>

<div id="outline-container-org8981717" class="outline-4">
<h4 id="iy-go-to-char"><a id="org8981717"></a><i>iy-go-to-char</i></h4>
<div class="outline-text-4" id="text-iy-go-to-char">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org61e981c"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> iy-go-to-char
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-m"</span> . iy-go-to-char<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-M"</span> . iy-go-to-char-backward<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-."</span> . iy-go-to-char-continue<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-,"</span> . iy-go-to-char-continue-backward<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
<b>iy-go-to-char</b> is a simple tool that provides functionality like Vim&rsquo;s <code>f</code>
and <code>F</code>. Works well, without any problems.
</p>
</div>
</div>

<div id="outline-container-org8d15f3f" class="outline-4">
<h4 id="avy"><a id="org8d15f3f"></a><i>avy</i></h4>
<div class="outline-text-4" id="text-avy">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org59b0b8e"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> avy
  <span style="color: #fe8019;">:commands</span> avy-isearch
  <span style="color: #fe8019;">:config</span> <span style="color: #b16286;">(</span>define-key isearch-mode-map <span style="color: #8ec07c;">(</span>kbd <span style="color: #b8bb26;">"M-g"</span><span style="color: #8ec07c;">)</span> 'avy-isearch<span style="color: #b16286;">)</span>
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-g M-g"</span> . avy-goto-line<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-g M-c"</span>   . avy-goto-char<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-g M-s"</span>   . avy-goto-char-timer<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-g M-w"</span>   . avy-goto-word-1<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
<b>avy</b> is the successor to <i>ace-jump-mode</i>. It lets you jump to things
visually, but using the keyboard. Smart man who came up with the original
idea.
</p>
</div>
</div>
</div>

<div id="outline-container-orgef4be07" class="outline-3">
<h3 id="windmove"><a id="orgef4be07"></a><span class="section-number-3">5.2</span> Moving between windows: <i>windmove</i></h3>
<div class="outline-text-3" id="text-windmove">
<p>
For the most part, especially when using Org-mode, I use the normal <code>C-x o</code> to
switch between windows, but sometimes when you have multiple windows open, it&rsquo;s
easier just to use <code>windmove</code>. It is a package that provides simple directional
movement between windows.
</p>

<p>
Personally, I use the default keybindings, which make use of <i>Shift</i> in
combination with any of the arrow keys.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org13ed6b0"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> windmove
  <span style="color: #fe8019;">:init</span> <span style="color: #b16286;">(</span>windmove-default-keybindings<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org624cf23" class="outline-3">
<h3 id="beginning-end-of-line"><a id="org624cf23"></a><span class="section-number-3">5.3</span> Moving to the beginning and end of a line</h3>
<div class="outline-text-3" id="text-beginning-end-of-line">
<p>
These are two functions that make Emacs feel a lot more friendly, especially for
an old Vim user. The <code>smarter-move-beginning-of-line</code> is based heavily on the
function with the same name from Emacs Redux, but <code>smarter-move-end-of-line</code> is
mostly a creation of my own, with inspiration from the <a href="https://www.emacswiki.org/emacs/EndOfLineNoComments">EmacsWiki</a>. It works
better and more reliably than any other solutions that I&rsquo;ve seen.
</p>

<p>
To summarize the behavior of the functions, <code>smarter-move-beginning-of-line</code>
toggles between Vim&rsquo;s <code>$</code> and <code>0</code> (indentation and real BOL), whereas
<code>smarter-move-end-of-line</code> toggles between the last non-space character before any
comment and the real EOL.
</p>

<p>
If you use tabs, you might want to replace the space-based <code>skip-syntax-backward</code>
call with a regex that includes all whitespace.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org232bcb0"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">smarter-move-beginning-of-line</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> <span style="color: #d3869b;">&amp;rest</span> args<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Move point back to indentation of beginning of line.</span>
<span style="color: #b8bb26;">Move point to the first non-whitespace character on this line. If</span>
<span style="color: #b8bb26;">point is already there, move to the beginning of the line.</span>
<span style="color: #b8bb26;">Effectively toggle between the first non-whitespace character and</span>
<span style="color: #b8bb26;">the beginning of the line. If ARG is not nil or 1, move forward</span>
<span style="color: #b8bb26;">ARG - 1 lines first. If point reaches the beginning or end of the</span>
<span style="color: #b8bb26;">buffer, stop there."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"^p"</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>arg <span style="color: #458588;">(</span><span style="color: #fb4934;">or</span> <span style="color: #b16286;">(</span>prefix-numeric-value current-prefix-arg<span style="color: #b16286;">)</span> 1<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Move lines first</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">when</span> <span style="color: #d65d0e;">(</span>/= arg 1<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">let</span> <span style="color: #458588;">(</span><span style="color: #b16286;">(</span>line-move-visual nil<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span>forward-line <span style="color: #b16286;">(</span>1- arg<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>orig-point <span style="color: #b16286;">(</span>point<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>back-to-indentation<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">when</span> <span style="color: #458588;">(</span>= orig-point <span style="color: #b16286;">(</span>point<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span>move-to-column 0<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">based on function from Emacs Redux</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">smarter-move-end-of-line</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> <span style="color: #d3869b;">&amp;rest</span> args<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Move to the end of the line, but before any potential comment.</span>
<span style="color: #b8bb26;">If already at the pre-comment end of line, move to the actual end</span>
<span style="color: #b8bb26;">of line. If ARG is not nil or 1, move forward ARG - 1 lines</span>
<span style="color: #b8bb26;">first. If point reaches the beginning or end of the buffer, stop</span>
<span style="color: #b8bb26;">there."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"^p"</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>arg <span style="color: #458588;">(</span><span style="color: #fb4934;">or</span> <span style="color: #b16286;">(</span>prefix-numeric-value current-prefix-arg<span style="color: #b16286;">)</span> 1<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">when</span> <span style="color: #d65d0e;">(</span>/= arg 1<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">let</span> <span style="color: #458588;">(</span><span style="color: #b16286;">(</span>line-move-visual nil<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span>forward-line <span style="color: #b16286;">(</span>1- arg<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>orig-point <span style="color: #b16286;">(</span>point<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>back-to-indentation<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">let</span> <span style="color: #458588;">(</span><span style="color: #b16286;">(</span>bol-point <span style="color: #8ec07c;">(</span>point<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span><span style="color: #fb4934;">let</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>comment-start <span style="color: #d65d0e;">(</span>comment-search-forward <span style="color: #458588;">(</span>point-at-eol<span style="color: #458588;">)</span> t<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
          <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">and</span> comment-start
                   <span style="color: #d65d0e;">(</span>not <span style="color: #458588;">(</span>eq comment-start bol-point<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
              <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">progn</span> <span style="color: #d65d0e;">(</span>goto-char comment-start<span style="color: #d65d0e;">)</span>
                     <span style="color: #d65d0e;">(</span>skip-syntax-backward <span style="color: #b8bb26;">" "</span> <span style="color: #458588;">(</span>point-at-bol<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
            <span style="color: #8ec07c;">(</span>move-end-of-line 1<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span><span style="color: #fb4934;">when</span> <span style="color: #b16286;">(</span>= orig-point <span style="color: #8ec07c;">(</span>point<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
          <span style="color: #b16286;">(</span>move-end-of-line 1<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga6ec17c"><span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">[</span>remap move-beginning-of-line<span style="color: #b16286;">]</span>
                'smarter-move-beginning-of-line<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">[</span>remap move-end-of-line<span style="color: #b16286;">]</span>
                'smarter-move-end-of-line<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1654fa8" class="outline-3">
<h3 id="scrolling-pleasantly"><a id="org1654fa8"></a><span class="section-number-3">5.4</span> Scrolling pleasantly</h3>
<div class="outline-text-3" id="text-scrolling-pleasantly">
<p>
Sometimes, the mouse is really useful. I love text-based interfaces, but they&rsquo;re
not perfect. Lucky for me, Emacs has good mouse support, at least in the GUI
version.
</p>

<p>
An annoying thing about using the mouse in Emacs, however, is scrolling. It
works well most of the time, until you hit the beginning or end of the buffer.
BEEP! If you haven&rsquo;t disabled the bell, you&rsquo;ll hear the bell. If you have
disabled the bell, you&rsquo;ll see an annoying <i>visual</i> bell. Yes, I know that I&rsquo;ve
enabled the visual bell myself, and I do like it. Just not when I&rsquo;m scrolling.
</p>

<p>
The following code surpresses any errors thrown by <code>mwheel-scroll</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org2e52328"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">silent-mwheel-scroll</span> <span style="color: #b16286;">(</span>oldfun <span style="color: #d3869b;">&amp;rest</span> r<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #8ec07c;">(</span>list last-input-event<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">ignore-errors</span>
    <span style="color: #8ec07c;">(</span>call-interactively oldfun<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>advice-add #'mwheel-scroll <span style="color: #fe8019;">:around</span> #'silent-mwheel-scroll<span style="color: #458588;">)</span>
</pre>
</div>

<p>
Much better! Funny how one small change can make Emacs feel ten years more
modern.
</p>
</div>
</div>
</div>


<div id="outline-container-org7d023d1" class="outline-2">
<h2 id="org7d023d1"><span class="section-number-2">6</span> Visual aids</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-org6bb9d97" class="outline-3">
<h3 id="origami"><a id="org6bb9d97"></a><span class="section-number-3">6.1</span> Folding with <i>origami</i></h3>
<div class="outline-text-3" id="text-origami">
<p>
Origami is a package that provides Vim-like folding. I have been an avid
Vim user, so folding is a natural part of my programming life.
</p>

<p>
The configuration that follows is <i>long</i>. I will therefore stop every now
and then, take a pause and explain what I&rsquo;ve done:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org4cc42c1"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> origami
  <span style="color: #fe8019;">:config</span>
  <span style="color: #b16286;">(</span>global-origami-mode t<span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">traverse-folds</span> <span style="color: #8ec07c;">(</span>times <span style="color: #d3869b;">&amp;optional</span> beginning<span style="color: #8ec07c;">)</span>
    <span style="color: #b8bb26;">"Traverses through folds as many times as ordered by argument.</span>
<span style="color: #b8bb26;">A negative argument makes it traverse backwards."</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span>&gt; times 0<span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span>move-end-of-line nil<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>move-beginning-of-line nil<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>fun <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span>&gt; times 0<span style="color: #8ec07c;">)</span> 'origami-forward-fold 'origami-previous-fold<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
          <span style="color: #458588;">(</span>beginning <span style="color: #b16286;">(</span><span style="color: #fb4934;">or</span> beginning <span style="color: #8ec07c;">(</span>point<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">dotimes</span> <span style="color: #458588;">(</span>i <span style="color: #b16286;">(</span>abs times<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span><span style="color: #fb4934;">condition-case</span> err
            <span style="color: #b16286;">(</span>funcall fun <span style="color: #8ec07c;">(</span>current-buffer<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>point<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
          <span style="color: #b16286;">(</span><span style="color: #fb4934; font-weight: bold;">error</span> <span style="color: #8ec07c;">(</span>message <span style="color: #b8bb26;">"Fold not found: %s"</span> err<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>set-mark beginning<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>deactivate-mark<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">next-fold</span> <span style="color: #8ec07c;">(</span>times<span style="color: #8ec07c;">)</span>
    <span style="color: #b8bb26;">"Jumps to the beginning of the next fold (or previous, on</span>
<span style="color: #b8bb26;">negative argument)."</span>

    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"P"</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">unless</span> times <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">setq</span> times 1<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>traverse-folds times<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">previous-fold</span> <span style="color: #8ec07c;">(</span>times<span style="color: #8ec07c;">)</span>
    <span style="color: #b8bb26;">"Jumps to the beginning of the previous fold, as many times</span>
<span style="color: #b8bb26;">as ordered by argument."</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"P"</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">unless</span> times <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">setq</span> times 1<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>next-fold <span style="color: #d65d0e;">(</span>* times -1<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">goto-fold</span> <span style="color: #8ec07c;">(</span>number<span style="color: #8ec07c;">)</span>
    <span style="color: #b8bb26;">"Jumps to fold # (provided by argument) in file."</span>

    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"P"</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>number <span style="color: #b16286;">(</span><span style="color: #fb4934;">or</span> number <span style="color: #8ec07c;">(</span>string-to-number <span style="color: #d65d0e;">(</span>read-string <span style="color: #b8bb26;">"Jump to fold: "</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
          <span style="color: #458588;">(</span>beginning <span style="color: #b16286;">(</span>point<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span>equal number 0<span style="color: #458588;">)</span> <span style="color: #458588;">(</span><span style="color: #fb4934;">setq</span> number 1<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span>&gt; number 0<span style="color: #458588;">)</span>
          <span style="color: #458588;">(</span>goto-char <span style="color: #b16286;">(</span>point-min<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span>goto-char <span style="color: #b16286;">(</span>point-max<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>traverse-folds number beginning<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Above are listed my own functions for traversing folds. I have functions</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">for going to the next, previous and nth fold, but they're all based on one</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">=traverse-folds= function. The reason I wrote my own function was that the</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">functions built into /origami/ didn't exactly work the way I wanted. They</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">would jump from fold end to fold end when jumping forwards - very annoying.</span>

  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-Z"</span>     . custom-origami-toggle-node<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-M-z"</span>   . origami-toggle-all-nodes<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c C-z"</span> . goto-fold<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c C-n"</span> . next-fold<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c C-p"</span> . previous-fold<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
Finally, some simple keybidnings, including ones for normal Origami
functions as well as for the above-defined custom functions.
</p>

<p>
In summary, it&rsquo;s a shame that this much configuration is needed to get such
a simple feature like folding working, especially when Vim supports it
almost perfectly from scratch. Overall, folding just doesn&rsquo;t seem to work
reliably in Emacs outside of Org-mode.
</p>
</div>
</div>

<div id="outline-container-orgf961754" class="outline-3">
<h3 id="show-trailing-whitespace"><a id="orgf961754"></a><span class="section-number-3">6.2</span> Highlighting superfluous whitespace</h3>
<div class="outline-text-3" id="text-show-trailing-whitespace">
<p>
With the following code, I enable highlighting of trailing whitespace in any
buffer whose mode descends from <i>prog-mode</i>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org9961c51"><span style="color: #458588;">(</span>add-hook 'prog-mode-hook <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span>
                            <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">setq-local</span> show-trailing-whitespace t<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org91300c8" class="outline-3">
<h3 id="org91300c8"><span class="section-number-3">6.3</span> Prettify symbols mode</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #458588;">(</span>add-hook 'emacs-lisp-mode-hook #'prettify-symbols-mode<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9d7aba" class="outline-3">
<h3 id="orgf9d7aba"><span class="section-number-3">6.4</span> <i>which-key</i></h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org0bfe47b"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> which-key
  <span style="color: #fe8019;">:config</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Use minibuffer instead of window (note: this sets `</span><span style="color: #d3869b;">which-key-popup-type</span><span style="color: #7c6f64;">'</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">automatically to `</span><span style="color: #d3869b;">minibuffer</span><span style="color: #7c6f64;">')</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">(which-key-setup-minibuffer)</span>
  <span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org64a5604" class="outline-2">
<h2 id="org64a5604"><span class="section-number-2">7</span> Helpful tools</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-org506415a" class="outline-3">
<h3 id="helm"><a id="org506415a"></a><span class="section-number-3">7.1</span> Helm</h3>
<div class="outline-text-3" id="text-helm">
<p>
I always feel a bit guilty when I use Helm. Which is, like, all the time,
because of how useful it is. I mostly use Helm &ldquo;as-is.&rdquo; I do have some code that
implements Helm completion from Eshell, which is very useful.
</p>

<p>
I have used alternatives to Helm, like Ido and Ivy, but I felt that Ido provided
too little, and that Ivy made things surprisingly complicated. Want to close all
Magit buffers? With Helm, you just enter &ldquo;magit&rdquo;, hit <code>&lt;C-space&gt;</code> a few times and
then <code>M-D</code>. With Ivy, you&rsquo;d have to find the first buffer to delete, then hit
<code>C-M-o</code> (instead of the normal <code>C-o</code> that&rsquo;s in your muscle memory) and <code>k</code> to kill the
<i>first</i> buffer. Then repeat it all those keystrokes for all remaining buffers.
</p>

<p>
Another thing I never liked about Ivy was its <code>describe-function</code> and
<code>describe-variable</code> integration. You would need to have your cursor <i>right next to</i>
the function or variable name in order to look it up, whereas with Helm, you can
be anywhere in the s-expression.
</p>

<p>
Helm is big, but it does its job <i>very</i> well, and it makes common actions <i>very</i>
simple. Ivy is evidence that smaller doesn&rsquo;t always mean simpler.
</p>

<p>
<b>Update:</b> I have reverted back to my old configuration to give Ivy a second
chance. I&rsquo;ve gotten a bit more used to it now - there are some things I still
don&rsquo;t like about it, but for now, I&rsquo;ll keep using it. Thus, I&rsquo;ve disabled Helm
below, using the <i>:disabled</i> keyword.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org1846a20"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> helm
  <span style="color: #fe8019;">:disabled</span>
  <span style="color: #fe8019;">:commands</span> helm-command-prefix
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-x"</span>     . helm-M-x<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-x C-f"</span> . helm-find-files<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-x C-b"</span> . helm-mini<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #fe8019;">:init</span>
  <span style="color: #b16286;">(</span>global-set-key <span style="color: #8ec07c;">(</span>kbd <span style="color: #b8bb26;">"C-c C-h"</span><span style="color: #8ec07c;">)</span> 'helm-command-prefix<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>global-unset-key <span style="color: #8ec07c;">(</span>kbd <span style="color: #b8bb26;">"C-x c"</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">require</span> '<span style="color: #d3869b;">helm-config</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>helm-mode 1<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>helm-flx-mode 1<span style="color: #b16286;">)</span>

  <span style="color: #fe8019;">:config</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Projectile integration</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> projectile-completion-system 'helm<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> projectile-switch-project-action 'helm-projectile<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>helm-projectile-on<span style="color: #b16286;">)</span>

  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Eshell completion</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">with-eval-after-load</span> 'eshell
    <span style="color: #8ec07c;">(</span>add-hook 'eshell-mode-hook
              <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #458588;">()</span>
                <span style="color: #458588;">(</span>eshell-cmpl-initialize<span style="color: #458588;">)</span>
                <span style="color: #458588;">(</span>define-key eshell-mode-map <span style="color: #b16286;">[</span>remap eshell-pcomplete<span style="color: #b16286;">]</span> #'helm-esh-pcomplete<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org109c85f" class="outline-3">
<h3 id="ivy"><a id="org109c85f"></a><span class="section-number-3">7.2</span> Ivy</h3>
<div class="outline-text-3" id="text-ivy">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga1c97c9"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> ivy
  <span style="color: #fe8019;">:init</span>
  <span style="color: #b16286;">(</span>ivy-mode 1<span style="color: #b16286;">)</span>
  <span style="color: #fe8019;">:config</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> ivy-use-virtual-buffers t<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> enable-recursive-minibuffers t<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> ivy-re-builders-alist
        '<span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>swiper . ivy--regex-plus<span style="color: #d65d0e;">)</span>
          <span style="color: #d65d0e;">(</span>t . ivy--regex-fuzzy<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-s"</span>     . swiper<span style="color: #8ec07c;">)</span>

         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c C-r"</span> . ivy-resume<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"&lt;f6&gt;"</span>    . ivy-resume<span style="color: #8ec07c;">)</span>

         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-x"</span>     . counsel-M-x<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-x C-f"</span> . counsel-find-file<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"&lt;f1&gt; f"</span>  . counsel-describe-function<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"&lt;f1&gt; v"</span>  . counsel-describe-variable<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"&lt;f1&gt; l"</span>  . counsel-find-library<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"&lt;f2&gt; i"</span>  . counsel-info-lookup-symbol<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"&lt;f2&gt; u"</span>  . counsel-unicode-char<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c k"</span>   . counsel-ag<span style="color: #8ec07c;">)</span>

         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-x l"</span>   . counsel-locate<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-x b"</span>   . ivy-switch-buffer<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-x C-b"</span> . ibuffer<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #fe8019;">:map</span> read-expression-map
              <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-r"</span> . counsel-expression-history<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> counsel
  <span style="color: #fe8019;">:bind</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Courtesy of Pragmatic Emacs</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">(see http://pragmaticemacs.com/emacs/counsel-yank-pop-with-a-tweak/)</span>
  <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-y"</span> . counsel-yank-pop<span style="color: #8ec07c;">)</span>
   <span style="color: #fe8019;">:map</span> ivy-minibuffer-map
   <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"M-y"</span> . ivy-next-line<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> counsel-projectile
  <span style="color: #fe8019;">:init</span>
  <span style="color: #b16286;">(</span>counsel-projectile-on<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>

<div id="outline-container-org12ddff7" class="outline-4">
<h4 id="counsel-everything"><a id="org12ddff7"></a><i>counsel-everything</i></h4>
<div class="outline-text-4" id="text-counsel-everything">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org79efcdc"><span style="color: #458588;">(</span><span style="color: #fb4934;">with-eval-after-load</span> 'ivy
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">TODO: Add support for ignoring absolute paths</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">counsel-everything</span> <span style="color: #8ec07c;">(</span><span style="color: #d3869b;">&amp;optional</span> dir<span style="color: #8ec07c;">)</span>
    <span style="color: #b8bb26;">"Find all files in the current directory, including subdirectories.</span>
<span style="color: #b8bb26;">If DIR is non-nil, use that directory instead of current one.</span>

<span style="color: #b8bb26;">From the minibuffer, C-&lt;backspace&gt; can be pressed to go up a</span>
<span style="color: #b8bb26;">directory, relative to DIR. Note that by default, you cannot go</span>
<span style="color: #b8bb26;">up to /, as processing this directory takes a long time and is</span>
<span style="color: #b8bb26;">rarely desirable."</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>dir <span style="color: #b16286;">(</span><span style="color: #fb4934;">or</span> dir <span style="color: #b8bb26;">"."</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
           <span style="color: #458588;">(</span>abs-path <span style="color: #b16286;">(</span>file-truename dir<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
           <span style="color: #458588;">(</span>dir-name <span style="color: #b16286;">(</span>file-name-nondirectory <span style="color: #8ec07c;">(</span>directory-file-name abs-path<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
           <span style="color: #458588;">(</span>ignored-dirs '<span style="color: #b16286;">(</span><span style="color: #b8bb26;">"*/.git"</span>
                           <span style="color: #b8bb26;">"*/elpa"</span>
                           <span style="color: #b8bb26;">"*/state"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
           <span style="color: #458588;">(</span>ignored-dirs-string <span style="color: #b16286;">(</span>mapconcat
                                 <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #d65d0e;">(</span>dir<span style="color: #d65d0e;">)</span>
                                   <span style="color: #d65d0e;">(</span>concat <span style="color: #b8bb26;">"-not </span><span style="color: #b8bb26; font-weight: bold;">\\</span><span style="color: #b8bb26; font-weight: bold;">(</span><span style="color: #b8bb26;"> -path '"</span> dir <span style="color: #b8bb26;">"' -prune </span><span style="color: #b8bb26; font-weight: bold;">\\</span><span style="color: #b8bb26; font-weight: bold;">)</span><span style="color: #b8bb26;">"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
                                 ignored-dirs <span style="color: #b8bb26;">" "</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
           <span style="color: #458588;">(</span>candidates <span style="color: #b16286;">(</span>mapcar
                        <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #d65d0e;">(</span>file<span style="color: #d65d0e;">)</span>
                          <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span>equal dir file<span style="color: #458588;">)</span>
                              nil
                            <span style="color: #458588;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span>string-prefix-p <span style="color: #b8bb26;">"find: "</span> file<span style="color: #458588;">)</span>
                                <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Ignore errors from `</span><span style="color: #d3869b;">find</span><span style="color: #7c6f64;">' (usually about</span>
                                <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">permissions):</span>
                                nil
                              <span style="color: #458588;">(</span>string-remove-prefix <span style="color: #b16286;">(</span>concat dir <span style="color: #b8bb26;">"/"</span><span style="color: #b16286;">)</span> file<span style="color: #458588;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
                        <span style="color: #8ec07c;">(</span>split-string
                         <span style="color: #d65d0e;">(</span>shell-command-to-string <span style="color: #458588;">(</span>concat <span style="color: #b8bb26;">"find "</span> dir <span style="color: #b8bb26;">" "</span>
                                                          ignored-dirs-string<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
                         <span style="color: #b8bb26;">"\n"</span> t<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">setf</span> counsel-everything--dir dir<span style="color: #d65d0e;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">set global dir value (for counsel-everything-up-directory)</span>
      <span style="color: #d65d0e;">(</span>ivy-read <span style="color: #458588;">(</span>format <span style="color: #b8bb26;">"(%s) Find everything: "</span> dir-name<span style="color: #458588;">)</span> candidates
                <span style="color: #fe8019;">:matcher</span> #'counsel--find-file-matcher
                <span style="color: #fe8019;">:action</span> <span style="color: #458588;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #b16286;">(</span>file<span style="color: #b16286;">)</span>
                          <span style="color: #b16286;">(</span><span style="color: #fb4934;">with-ivy-window</span>
                            <span style="color: #8ec07c;">(</span>find-file <span style="color: #d65d0e;">(</span>expand-file-name file counsel-everything--dir<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
                <span style="color: #fe8019;">:keymap</span> <span style="color: #458588;">(</span>make-counsel-everything-map<span style="color: #458588;">)</span>
                <span style="color: #fe8019;">:require-match</span> 'confirm-after-completion
                <span style="color: #fe8019;">:caller</span> #'counsel-everything<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span>ivy-set-actions
   #'counsel-everything
   '<span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span><span style="color: #b8bb26;">"j"</span> find-file-other-window <span style="color: #b8bb26;">"other window"</span><span style="color: #d65d0e;">)</span>
     <span style="color: #d65d0e;">(</span><span style="color: #b8bb26;">"x"</span> counsel-find-file-extern <span style="color: #b8bb26;">"open externally"</span><span style="color: #d65d0e;">)</span>
     <span style="color: #d65d0e;">(</span><span style="color: #b8bb26;">"r"</span> counsel-find-file-as-root <span style="color: #b8bb26;">"open as root"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defvar</span> <span style="color: #83a598;">counsel-everything--dir</span> nil
    <span style="color: #b8bb26;">"Internal variable used by counsel-everything-up-directory."</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">make-counsel-everything-map</span> <span style="color: #8ec07c;">()</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>map <span style="color: #b16286;">(</span>make-sparse-keymap<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>define-key map <span style="color: #458588;">(</span>kbd <span style="color: #b8bb26;">"C-DEL"</span><span style="color: #458588;">)</span>         #'counsel-everything-up-directory<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>define-key map <span style="color: #458588;">(</span>kbd <span style="color: #b8bb26;">"C-&lt;backspace&gt;"</span><span style="color: #458588;">)</span> #'counsel-everything-up-directory<span style="color: #d65d0e;">)</span>
      map<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">counsel-everything-up-directory</span> <span style="color: #8ec07c;">()</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>dir <span style="color: #b8bb26;">""</span><span style="color: #458588;">)</span>
          <span style="color: #458588;">(</span>up-dir<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span><span style="color: #fb4934;">and</span> <span style="color: #b16286;">(</span>boundp 'counsel-everything--dir<span style="color: #b16286;">)</span>
               <span style="color: #b16286;">(</span>not <span style="color: #8ec07c;">(</span>equal counsel-everything--dir <span style="color: #b8bb26;">"."</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
          <span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> dir <span style="color: #b16286;">(</span>concat counsel-everything--dir <span style="color: #b8bb26;">"/"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">setf</span> up-dir <span style="color: #458588;">(</span>format <span style="color: #b8bb26;">"%s.."</span> dir<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">unless</span> <span style="color: #458588;">(</span>string-equal <span style="color: #b16286;">(</span>file-truename up-dir<span style="color: #b16286;">)</span> <span style="color: #b8bb26;">"/"</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span>eval `<span style="color: #b16286;">(</span>run-at-time nil nil
                            <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #d65d0e;">()</span>
                              <span style="color: #d65d0e;">(</span>counsel-everything ,up-dir<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span>minibuffer-keyboard-quit<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span>global-set-key <span style="color: #8ec07c;">(</span>kbd <span style="color: #b8bb26;">"C-x C-M-f"</span><span style="color: #8ec07c;">)</span> #'counsel-everything<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org6f1925a" class="outline-3">
<h3 id="swiper"><a id="org6f1925a"></a><span class="section-number-3">7.3</span> Swiper</h3>
<div class="outline-text-3" id="text-swiper">
<p>
All right, so I know I said I didn&rsquo;t like Ivy, but I do like Swiper, which uses
Ivy. It&rsquo;s far better than both <code>isearch</code> and <code>helm-occur</code>. That said, if you know
about a package with equivalent functionality, but for Helm, please let me know!
</p>

<p>
The following configuration sets up Swiper to use <code>C-s</code>. I also set up Ivy, since
Swiper requires Ivy and <code>swiper-helm</code> didn&rsquo;t work, but I <i>defer</i> its loading until
it&rsquo;s needed by Swiper.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org84a076b"><span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">(use-package ivy</span>
<span style="color: #7c6f64;">;;   </span><span style="color: #7c6f64;">:defer t)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> swiper
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-s"</span> . swiper<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1cca299" class="outline-3">
<h3 id="projectile"><a id="org1cca299"></a><span class="section-number-3">7.4</span> Projectile</h3>
<div class="outline-text-3" id="text-projectile">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org2a5d6e4"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> projectile
  <span style="color: #fe8019;">:config</span>
  <span style="color: #b16286;">(</span>projectile-global-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> projectile-enable-caching t<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> projectile-require-project-root nil<span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> projectile-globally-ignored-directories
        <span style="color: #8ec07c;">(</span>cl-list* <span style="color: #b8bb26;">".cache"</span> <span style="color: #b8bb26;">".cargo"</span>
                  projectile-globally-ignored-directories<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
Projectile is a package that I use for two reasons: the Helm integration
and the file finder.
</p>
</div>
</div>

<div id="outline-container-org9c9f97d" class="outline-3">
<h3 id="magit"><a id="org9c9f97d"></a><span class="section-number-3">7.5</span> Magit</h3>
<div class="outline-text-3" id="text-magit">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org1117518"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> magit
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #b8bb26;">"C-c g"</span> . magit-status<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
The fact that <b>magit</b> requires this little configuration, yet is so
incredibly useful, is a testament to good design. The only thing I could
possibly complain about is the speed. It does run slow on my computer. I
hope it&rsquo;s just because I&rsquo;m running it on the Windows Subsystem for Linux.
</p>
</div>
</div>

<div id="outline-container-orgaa26be7" class="outline-3">
<h3 id="eshell"><a id="orgaa26be7"></a><span class="section-number-3">7.6</span> Eshell</h3>
<div class="outline-text-3" id="text-eshell">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orge4790df"><span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"C-x 4 e"</span><span style="color: #b16286;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">open eshell in split to the right</span>
                <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span>
                  <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span>
                  <span style="color: #8ec07c;">(</span>split-window-right<span style="color: #8ec07c;">)</span>
                  <span style="color: #8ec07c;">(</span>other-window 1<span style="color: #8ec07c;">)</span>
                  <span style="color: #8ec07c;">(</span>eshell<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org62095cc" class="outline-3">
<h3 id="git-gutter"><a id="org62095cc"></a><span class="section-number-3">7.7</span> <i>git-gutter+</i></h3>
<div class="outline-text-3" id="text-git-gutter">
<p>
As much as I love Magit, it&rsquo;s big, unwieldy and a bit slow. When editing my
Emacs configuration, I find that I postpone staging and commiting my changes,
lating having to do it all at once. It&rsquo;s annoying.
</p>

<p>
<code>git-gutter+</code> is an excellent package that lets me stage individual hunks of
changes without even leaving the buffer of the edited file. It works by
displaying plus and minus signs left of the fringe, indicating what lines have
been changed.
</p>

<p>
Just because it is so useful, I dedicate the prefix <code>C-M-g</code> to all <code>git-gutter+</code>
commands.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org51be7e3"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> git-gutter+
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-M-g C-M-g"</span> . git-gutter+-mode<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #fe8019;">:map</span> git-gutter+-mode-map
              <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-M-g n"</span> . git-gutter+-next-hunk<span style="color: #8ec07c;">)</span>
              <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-M-g p"</span> . git-gutter+-previous-hunk<span style="color: #8ec07c;">)</span>
              <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-M-g d"</span> . git-gutter+-show-hunk<span style="color: #8ec07c;">)</span>
              <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-M-g r"</span> . git-gutter+-revert-hunks<span style="color: #8ec07c;">)</span>
              <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-M-g s"</span> . git-gutter+-stage-hunks<span style="color: #8ec07c;">)</span>
              <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-M-g c"</span> . git-gutter+-commit<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
The only problem I have with the package is that it doesn&rsquo;t use the actual
fringe. I have tried the extension <code>git-gutter+-fringe</code>, but I never got it to
work. Perhaps it needs updating, I don&rsquo;t know. For now, <code>git-gutter+</code> works fine.
</p>
</div>
</div>
<div id="outline-container-org2230ef3" class="outline-3">
<h3 id="openwith"><a id="org2230ef3"></a><span class="section-number-3">7.8</span> <i>openwith</i></h3>
<div class="outline-text-3" id="text-openwith">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org5dadc45"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> openwith
  <span style="color: #fe8019;">:init</span>
  <span style="color: #b16286;">(</span>openwith-mode t<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> openwith-associations '<span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span><span style="color: #b8bb26;">"\\.pdf\\'"</span> <span style="color: #b8bb26;">"mupdf"</span> <span style="color: #458588;">(</span>file<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
<b>openwith</b> is a nice little plugin that does one thing very well. It tells Emacs
to open certain files in external programs. I personally use <i>mupdf</i> for all my
PDF reading.
</p>
</div>
</div>
</div>


<div id="outline-container-org002cbd1" class="outline-2">
<h2 id="org002cbd1"><span class="section-number-2">8</span> Modes</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-org1f303ae" class="outline-3">
<h3 id="org-mode"><a id="org1f303ae"></a><span class="section-number-3">8.1</span> Org</h3>
<div class="outline-text-3" id="text-org-mode">
<p>
Org-mode is where I spend much of my Emacs time. I use it for writing, studying,
planning and, of course, configuring Emacs. My configuration began small but
as I&rsquo;ve begun to use it more it has just kept growing.
</p>

<p>
This is the main configuration. You&rsquo;ll see a few references to custom <code>org-</code>
functions - they are defined further down.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orge14e195"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> org
  <span style="color: #fe8019;">:mode</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"\\.org$"</span> . org-mode<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #fe8019;">:ensure</span> org-plus-contrib
  <span style="color: #fe8019;">:demand</span>
  <span style="color: #fe8019;">:config</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Make ' and " work in inline code</span>
  <span style="color: #b16286;">(</span>setcar <span style="color: #8ec07c;">(</span>nthcdr 2 org-emphasis-regexp-components<span style="color: #8ec07c;">)</span> <span style="color: #b8bb26;">" \t\r\n,"</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>org-set-emph-re 'org-emphasis-regexp-components
                   org-emphasis-regexp-components<span style="color: #b16286;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">reload setting</span>

  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Make windmove work in org-mode (not very useful)</span>
  <span style="color: #b16286;">(</span>add-hook 'org-shiftup-final-hook 'windmove-up<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'org-shiftleft-final-hook 'windmove-left<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'org-shiftdown-final-hook 'windmove-down<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'org-shiftright-final-hook 'windmove-right<span style="color: #b16286;">)</span>

  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Export to exports/ subdirectory</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">/org-export-to-subdirectory</span> <span style="color: #8ec07c;">(</span>orig-fun <span style="color: #d3869b;">&amp;rest</span> args<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>shell-command <span style="color: #d65d0e;">(</span>concat <span style="color: #b8bb26;">"mkdir -p exports"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>apply orig-fun
           <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">pop</span> args<span style="color: #d65d0e;">)</span>                     <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">backend</span>
           <span style="color: #d65d0e;">(</span>concat <span style="color: #b8bb26;">"exports/"</span> <span style="color: #458588;">(</span><span style="color: #fb4934;">pop</span> args<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">file</span>
           args<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>advice-add #'org-export-to-file <span style="color: #fe8019;">:around</span> #'/org-export-to-subdirectory<span style="color: #b16286;">)</span>

  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Remove keybindings that I already use</span>
  <span style="color: #b16286;">(</span>define-key org-mode-map <span style="color: #8ec07c;">(</span>kbd <span style="color: #b8bb26;">"C-'"</span><span style="color: #8ec07c;">)</span> nil<span style="color: #b16286;">)</span>

  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Enable for all Org files</span>
  <span style="color: #b16286;">(</span>add-hook 'org-mode-hook #'swedish-mode<span style="color: #b16286;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">Swedish letters</span>
  <span style="color: #b16286;">(</span>add-hook 'org-mode-hook #'org-autolist-mode<span style="color: #b16286;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">better list behavior</span>

  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c o a"</span> . org-agenda<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c o l"</span> . org-store-link<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c o c"</span> . org-capture<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c o b"</span> . org-iswitchb<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>

<div id="outline-container-orgce38ed9" class="outline-4">
<h4 id="org-tree-view"><a id="orgce38ed9"></a><i>org-tree-view</i></h4>
<div class="outline-text-4" id="text-org-tree-view">
<p>
Sometimes, I use to write large documents with many headings and many levels.
Sometimes, keeping track of it all requires a substantial amount of brain power.
Wouldn&rsquo;t it be great to have a small outline to the left of the text, where you
could select a section and narrow in on it in a big window to the right?
</p>

<p>
That&rsquo;s what the <code>org-tree-view</code> functions are for. They started out as carbon
copies of two answers on the Emacs StackExchange, by <a href="https://emacs.stackexchange.com/a/9532">Dan</a> and <a href="https://emacs.stackexchange.com/a/14987">blujay</a>
respectively, but they have developed into something quite solid.
</p>


<div id="org50b8406" class="figure">
<p><img src="./resources/org-tree-view-new.png" alt="org-tree-view-new.png" />
</p>
<p><span class="figure-number">Figure 1: </span><i>org-tree-view</i> in combination with the theme <i>leuven</i></p>
</div>

<p>
It works by opening a clone of the current Org buffer in a new window to the
left. The cloned buffer, called the <i>tree view</i>, has the following properties:
</p>

<ul class="org-ul">
<li>It displays nothing but headings</li>
<li>On <code>&lt;return&gt;</code> or <code>&lt;mouse-1&gt;</code>, the heading at point is opened in the <i>base buffer</i> and
the base buffer is narrowed to the subtree of the heading</li>
<li>When you open a heading, you can press the same key again, within one second of
delay, to close the tree view behind you</li>
<li>On <code>&lt;tab&gt;</code>, visibility is toggled between all headings and the levels of
headings set in <code>org-tree-view/levels</code> (default: 3)</li>
<li>On <code>Q</code>, the tree view is closed and its buffer deleted</li>
<li>On any other non-modifier key, it automatically starts searching through the
headings (but, crucially, not the rest of the text) using <code>isearch</code></li>
<li>Within <code>isearch</code>, <code>&lt;S-return&gt;</code> opens the currently selected matching heading in
the base buffer</li>
</ul>
</div>

<div id="outline-container-org3446232" class="outline-5">
<h5 id="org3446232">Minor mode definition</h5>
<div class="outline-text-5" id="text-org3446232">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org86a24c3"><span style="color: #458588;">(</span><span style="color: #fb4934;">defvar</span> <span style="color: #83a598;">org-tree-view-mode-map</span> <span style="color: #b16286;">(</span>make-sparse-keymap<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>define-key org-tree-view-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"&lt;return&gt;"</span><span style="color: #b16286;">)</span>  #'org-tree-view/open-headline-at-point<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>define-key org-tree-view-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"&lt;mouse-1&gt;"</span><span style="color: #b16286;">)</span> #'org-tree-view/open-headline-at-point<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>define-key org-tree-view-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"C-g"</span><span style="color: #b16286;">)</span>       #'org-tree-view/close<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>define-key org-tree-view-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"&lt;tab&gt;"</span><span style="color: #b16286;">)</span>     #'org-tree-view/toggle-visibility<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>define-key org-tree-view-mode-map <span style="color: #b16286;">[</span>remap end-of-buffer<span style="color: #b16286;">]</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>goto-char <span style="color: #d65d0e;">(</span>point-max<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>move-beginning-of-line 1<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Re-define self-insert-command</span>
<span style="color: #458588;">(</span>map-keymap <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">(</span>key fun<span style="color: #8ec07c;">)</span>
              <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span>equal fun #'self-insert-command<span style="color: #d65d0e;">)</span>
                  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Append ((from . to) #'org-tree-view/self-insert-command))</span>
                  <span style="color: #d65d0e;">(</span>nconc org-tree-view-mode-map
                        <span style="color: #458588;">(</span>list <span style="color: #b16286;">(</span>cons key #'org-tree-view/self-insert-command<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
            <span style="color: #b16286;">(</span>current-global-map<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">setq</span> org-tree-view-mode-map <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">develop (from . to) ranges, please</span>
      <span style="color: #b16286;">(</span>keymap-canonicalize org-tree-view-mode-map<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">define-minor-mode</span> <span style="color: #fabd2f;">org-tree-view-mode</span>
  <span style="color: #b8bb26;">""</span>
  nil
  <span style="color: #fe8019;">:lighter</span> <span style="color: #b8bb26;">" tree-view"</span>
  org-tree-view-mode-map<span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">provide</span> '<span style="color: #d3869b;">org-tree-view-mode</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org724ef1f" class="outline-5">
<h5 id="org724ef1f">Rendering the tree view</h5>
<div class="outline-text-5" id="text-org724ef1f">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org0c8c8be"><span style="color: #458588;">(</span><span style="color: #fb4934;">require</span> '<span style="color: #d3869b;">subr-x</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/get-headlines</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> level <span style="color: #d3869b;">&amp;optional</span> base-buffer<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Get a list of all headlines in `</span><span style="color: #d3869b;">base-buffer</span><span style="color: #b8bb26;">' of a level less</span>
<span style="color: #b8bb26;">than or equal to provided `</span><span style="color: #d3869b;">level</span><span style="color: #b8bb26;">'. Includes headlines outside of</span>
<span style="color: #b8bb26;">any potential narrowing."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>level <span style="color: #458588;">(</span><span style="color: #fb4934;">or</span> level org-tree-view/level<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span>base-buffer
         <span style="color: #458588;">(</span><span style="color: #fb4934;">or</span> base-buffer
             <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span>org-tree-view/is-tree-view<span style="color: #8ec07c;">)</span>
                 <span style="color: #8ec07c;">(</span>get-buffer <span style="color: #d65d0e;">(</span>org-tree-view/make-base-buffer-name<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
               <span style="color: #8ec07c;">(</span>current-buffer<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span>headlines<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">with-current-buffer</span> base-buffer
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">let</span> <span style="color: #458588;">(</span><span style="color: #b16286;">(</span>widened-buffer
             <span style="color: #8ec07c;">(</span>clone-indirect-buffer
              <span style="color: #d65d0e;">(</span>concat <span style="color: #b8bb26;">"&lt;widened&gt;"</span> <span style="color: #458588;">(</span>buffer-name base-buffer<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span> nil<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span><span style="color: #fb4934;">with-current-buffer</span> widened-buffer
          <span style="color: #b16286;">(</span>widen<span style="color: #b16286;">)</span>
          <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> headlines <span style="color: #8ec07c;">(</span>org-element-map <span style="color: #d65d0e;">(</span>org-element-parse-buffer 'headline<span style="color: #d65d0e;">)</span> 'headline
                            <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #458588;">(</span>headline<span style="color: #458588;">)</span>
                              <span style="color: #458588;">(</span><span style="color: #fb4934;">when</span> <span style="color: #458588;">(</span>&lt;= <span style="color: #b16286;">(</span>org-element-property <span style="color: #fe8019;">:level</span> headline<span style="color: #b16286;">)</span> level<span style="color: #458588;">)</span>
                                headline<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span>kill-buffer widened-buffer<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    headlines<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/draw-headline</span> <span style="color: #b16286;">(</span>headline<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Return a string of the headline to be printed, with the proper</span>
<span style="color: #b8bb26;">face and its position in the base buffer encoded as the</span>
<span style="color: #b8bb26;">`</span><span style="color: #d3869b;">org-tree-view-headline-pos</span><span style="color: #b8bb26;">' text property."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>title <span style="color: #458588;">(</span>org-element-property <span style="color: #fe8019;">:raw-value</span> headline<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>level <span style="color: #458588;">(</span>org-element-property <span style="color: #fe8019;">:level</span> headline<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>begin <span style="color: #458588;">(</span>org-element-property <span style="color: #fe8019;">:begin</span> headline<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>end <span style="color: #458588;">(</span>org-element-property <span style="color: #fe8019;">:end</span> headline<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>org-tree-view-level-face <span style="color: #458588;">(</span>intern
                                    <span style="color: #b16286;">(</span>concat <span style="color: #b8bb26;">"org-tree-view/level-"</span>
                                            <span style="color: #8ec07c;">(</span>number-to-string level<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>text <span style="color: #458588;">(</span>concat <span style="color: #b16286;">(</span>apply #'concat <span style="color: #8ec07c;">(</span>make-list <span style="color: #d65d0e;">(</span>* 2 <span style="color: #458588;">(</span>1- level<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span> <span style="color: #b8bb26;">" "</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
                       <span style="color: #b8bb26;">"* "</span>
                       <span style="color: #b16286;">(</span>replace-regexp-in-string <span style="color: #b8bb26;">"\""</span> <span style="color: #b8bb26;">""</span> title nil t<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">remove \" from title</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Text properties</span>
    <span style="color: #8ec07c;">(</span>put-text-property <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">org-tree-view-level-N</span>
     0 <span style="color: #d65d0e;">(</span>length text<span style="color: #d65d0e;">)</span>
     'font-lock-face org-tree-view-level-face
     text<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>put-text-property <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">encode headling position in base buffer</span>
     0 <span style="color: #d65d0e;">(</span>length text<span style="color: #d65d0e;">)</span>
     'org-tree-view-headline-pos begin
     text<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">setq</span> text <span style="color: #d65d0e;">(</span>org-tree-view/draw-string text<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Pad headline with spaces</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>end <span style="color: #b16286;">(</span>1- <span style="color: #8ec07c;">(</span>length text<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">setq</span> text <span style="color: #458588;">(</span>concat text
                         <span style="color: #b16286;">(</span>apply #'concat <span style="color: #8ec07c;">(</span>make-list <span style="color: #d65d0e;">(</span>* 2 org-tree-view/width<span style="color: #d65d0e;">)</span> <span style="color: #b8bb26;">" "</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Add same properties to padding (a little repetitive)</span>
      <span style="color: #d65d0e;">(</span>put-text-property
       end <span style="color: #458588;">(</span>length text<span style="color: #458588;">)</span>
       'font-lock-face org-tree-view-level-face
       text<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>put-text-property
       end <span style="color: #458588;">(</span>length text<span style="color: #458588;">)</span>
       'org-tree-view-headline-pos begin
       text<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    text<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/draw-string</span> <span style="color: #b16286;">(</span>text<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Apply the appropriate faces on `</span><span style="color: #d3869b;">text</span><span style="color: #b8bb26;">' according to Org markup</span>
<span style="color: #b8bb26;">syntax and return the resulting string."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>types '<span style="color: #458588;">(</span>link
                  italic
                  bold
                  strike-through
                  verbatim
                  code<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>data <span style="color: #458588;">(</span>org-element-parse-secondary-string text types<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>org-element-map data types
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #458588;">(</span>object<span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>type <span style="color: #d65d0e;">(</span>org-element-type object<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
               <span style="color: #8ec07c;">(</span>begin <span style="color: #d65d0e;">(</span>1- <span style="color: #458588;">(</span>org-element-property <span style="color: #fe8019;">:begin</span> object<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
               <span style="color: #8ec07c;">(</span>end <span style="color: #d65d0e;">(</span>1- <span style="color: #458588;">(</span>org-element-property <span style="color: #fe8019;">:end</span> object<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
               <span style="color: #8ec07c;">(</span>faces
                '<span style="color: #d65d0e;">(</span>italic         italic
                  bold           bold
                  strike-through <span style="color: #458588;">(</span><span style="color: #fe8019;">:strike-through</span> t<span style="color: #458588;">)</span>
                  verbatim       org-verbatim
                  code           org-code<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

          <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Figure out real end of object</span>
          <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>substr <span style="color: #458588;">(</span>string-trim-right <span style="color: #458588;">(</span>substring text begin end<span style="color: #458588;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
            <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">setq</span> end <span style="color: #d65d0e;">(</span>+ begin <span style="color: #458588;">(</span>length substr<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

          <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Handle faces</span>
          <span style="color: #b16286;">(</span><span style="color: #fb4934;">when</span> <span style="color: #8ec07c;">(</span>member type faces<span style="color: #8ec07c;">)</span>
            <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>face <span style="color: #458588;">(</span>plist-get faces type<span style="color: #458588;">)</span><span style="color: #458588;">)</span>
                   <span style="color: #458588;">(</span>existing-face <span style="color: #458588;">(</span>get-text-property begin 'font-lock-face text<span style="color: #458588;">)</span><span style="color: #458588;">)</span>
                   <span style="color: #458588;">(</span>new-face <span style="color: #458588;">(</span><span style="color: #fb4934;">if</span> existing-face
                                 `<span style="color: #b16286;">(</span>,face ,existing-face<span style="color: #b16286;">)</span>
                               face<span style="color: #458588;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
              <span style="color: #d65d0e;">(</span>put-text-property <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">add face for type</span>
               begin end
               'font-lock-face new-face
               text<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
            <span style="color: #8ec07c;">(</span>put-text-property <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">remove first piece of markup</span>
             begin <span style="color: #d65d0e;">(</span>1+ begin<span style="color: #d65d0e;">)</span>
             'display <span style="color: #b8bb26;">""</span>
             text<span style="color: #8ec07c;">)</span>
            <span style="color: #8ec07c;">(</span>put-text-property <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">remove second piece of markup</span>
             <span style="color: #d65d0e;">(</span>1- end<span style="color: #d65d0e;">)</span> end
             'display <span style="color: #b8bb26;">""</span>
             text<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

          <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Handle links</span>
          <span style="color: #b16286;">(</span><span style="color: #fb4934;">when</span> <span style="color: #8ec07c;">(</span>equal 'link type<span style="color: #8ec07c;">)</span>
            <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>contents-begin <span style="color: #458588;">(</span>org-element-property <span style="color: #fe8019;">:contents-begin</span> object<span style="color: #458588;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
              <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> contents-begin <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">has contents</span>
                  <span style="color: #458588;">(</span>put-text-property
                   begin <span style="color: #458588;">(</span>1- contents-begin<span style="color: #458588;">)</span>
                   'display <span style="color: #b8bb26;">""</span>
                   text<span style="color: #458588;">)</span>
                <span style="color: #458588;">(</span>put-text-property <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">only url</span>
                 begin <span style="color: #458588;">(</span>+ begin 2<span style="color: #458588;">)</span>
                 'display <span style="color: #b8bb26;">""</span>
                 text<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
              <span style="color: #d65d0e;">(</span>put-text-property
               <span style="color: #458588;">(</span>- end 2<span style="color: #458588;">)</span> end
               'display <span style="color: #b8bb26;">""</span>
               text<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    text<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/insert-headlines</span> <span style="color: #b16286;">()</span>
  <span style="color: #b8bb26;">"Insert all drawn headlines at the current position."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>headlines <span style="color: #458588;">(</span>org-tree-view/get-headlines<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">cl-loop</span> for headline in headlines
       do <span style="color: #d65d0e;">(</span>insert <span style="color: #458588;">(</span>concat
                   <span style="color: #b16286;">(</span>org-tree-view/draw-headline headline<span style="color: #b16286;">)</span>
                   <span style="color: #b8bb26;">"\n"</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Delete final newline</span>
    <span style="color: #8ec07c;">(</span>backward-delete-char 1<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/refresh</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> no-set-window-start<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>orig-window-start <span style="color: #458588;">(</span>window-start<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>orig-window-line  <span style="color: #458588;">(</span>+ <span style="color: #b16286;">(</span>count-lines <span style="color: #8ec07c;">(</span>window-start<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>point<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
                               <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span>= <span style="color: #d65d0e;">(</span>current-column<span style="color: #d65d0e;">)</span> 0<span style="color: #8ec07c;">)</span> 1 0<span style="color: #b16286;">)</span>
                               -1<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">^ see http://www.delorie.com/gnu/docs/elisp-manual-21/elisp_478.html</span>
         <span style="color: #d65d0e;">(</span>refresh `<span style="color: #458588;">(</span><span style="color: #fb4934;">progn</span>
                     <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq-local</span> buffer-read-only nil<span style="color: #b16286;">)</span>
                     <span style="color: #b16286;">(</span>set-window-fringes <span style="color: #8ec07c;">(</span>get-buffer-window<span style="color: #8ec07c;">)</span> 8 1<span style="color: #b16286;">)</span>
                     <span style="color: #b16286;">(</span>erase-buffer<span style="color: #b16286;">)</span>
                     <span style="color: #b16286;">(</span>org-tree-view/insert-headlines<span style="color: #b16286;">)</span>
                     <span style="color: #b16286;">(</span>set-window-start <span style="color: #8ec07c;">(</span>get-buffer-window<span style="color: #8ec07c;">)</span> orig-window-start<span style="color: #b16286;">)</span>
                     <span style="color: #b16286;">(</span>goto-char <span style="color: #8ec07c;">(</span>window-start<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
                     <span style="color: #b16286;">(</span>forward-line orig-window-line<span style="color: #b16286;">)</span>
                     <span style="color: #b16286;">(</span>move-beginning-of-line 1<span style="color: #b16286;">)</span>
                     <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq-local</span> buffer-read-only t<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span>org-tree-view/is-tree-view<span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span>eval <span style="color: #458588;">(</span>macroexpand refresh<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span>org-tree-view/has-tree-view<span style="color: #458588;">)</span>
          <span style="color: #458588;">(</span><span style="color: #fb4934;">with-current-buffer</span> <span style="color: #b16286;">(</span>org-tree-view/make-tree-view-buffer-name<span style="color: #b16286;">)</span>
            <span style="color: #b16286;">(</span>eval <span style="color: #8ec07c;">(</span>macroexpand refresh<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd419b99" class="outline-5">
<h5 id="orgd419b99">Interacting with the tree view</h5>
<div class="outline-text-5" id="text-orgd419b99">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org4035249"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/open</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> arg<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">""</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"p"</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>tree-view-buffer-name <span style="color: #458588;">(</span>org-tree-view/make-tree-view-buffer-name<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span>base-buffer <span style="color: #458588;">(</span>current-buffer<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span>tree-view-buffer<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">and</span> <span style="color: #458588;">(</span>org-tree-view/has-tree-view<span style="color: #458588;">)</span>
             <span style="color: #458588;">(</span>get-buffer-window tree-view-buffer-name<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">progn</span>
          <span style="color: #458588;">(</span>select-window <span style="color: #b16286;">(</span>get-buffer-window tree-view-buffer-name<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
          <span style="color: #458588;">(</span><span style="color: #fb4934;">setq</span> tree-view-buffer <span style="color: #b16286;">(</span>get-buffer tree-view-buffer-name<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span>org-tree-view/has-tree-view<span style="color: #458588;">)</span>
          <span style="color: #458588;">(</span>kill-buffer <span style="color: #b16286;">(</span>org-tree-view/make-tree-view-buffer-name<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span>equal org-tree-view/side 'left<span style="color: #458588;">)</span>
          <span style="color: #458588;">(</span>split-window-right org-tree-view/width<span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span>split-window-right <span style="color: #b16286;">(</span>* -1 org-tree-view/width<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span>other-window 1<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">setq</span> tree-view-buffer <span style="color: #458588;">(</span>generate-new-buffer tree-view-buffer-name<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Switch to tree view buffer</span>
    <span style="color: #8ec07c;">(</span>switch-to-buffer tree-view-buffer<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>org-tree-view/setup<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>org-tree-view-mode<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/close</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> tree-view-buffer <span style="color: #d3869b;">&amp;optional</span> base-buffer<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Close `</span><span style="color: #d3869b;">tree-view-buffer</span><span style="color: #b8bb26;">' for `</span><span style="color: #d3869b;">base-buffer</span><span style="color: #b8bb26;">'. Defaults to the current buffer."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>base-buffer
          <span style="color: #458588;">(</span>get-buffer <span style="color: #b16286;">(</span><span style="color: #fb4934;">or</span> base-buffer
                          <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span>org-tree-view/is-tree-view<span style="color: #d65d0e;">)</span>
                              <span style="color: #d65d0e;">(</span>org-tree-view/make-base-buffer-name<span style="color: #d65d0e;">)</span>
                            <span style="color: #d65d0e;">(</span>current-buffer<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>tree-view-buffer
          <span style="color: #458588;">(</span>get-buffer <span style="color: #b16286;">(</span><span style="color: #fb4934;">or</span> tree-view-buffer
                          <span style="color: #8ec07c;">(</span>org-tree-view/make-tree-view-buffer-name base-buffer<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>tree-view-window<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> tree-view-buffer
        <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">progn</span> <span style="color: #458588;">(</span><span style="color: #fb4934;">if</span> <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq</span> tree-view-window <span style="color: #8ec07c;">(</span>get-buffer-window tree-view-buffer<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
                   <span style="color: #b16286;">(</span>delete-window tree-view-window<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
               <span style="color: #458588;">(</span>kill-buffer tree-view-buffer<span style="color: #458588;">)</span>
               <span style="color: #458588;">(</span>org-tree-view/cleanup<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934; font-weight: bold;">error</span> <span style="color: #b8bb26;">"No tree view found!"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/bind-close-after</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> key<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Bind the key combination pressed to call</span>
<span style="color: #b8bb26;">`</span><span style="color: #d3869b;">org-tree-view/open-headline-at-point</span><span style="color: #b8bb26;">' to also close the tree</span>
<span style="color: #b8bb26;">view, but only for 1 second."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>key <span style="color: #458588;">(</span><span style="color: #fb4934;">or</span> key <span style="color: #b16286;">(</span>this-command-keys-vector<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>original-binding <span style="color: #458588;">(</span>local-key-binding key<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>reset-key `<span style="color: #458588;">(</span>local-set-key ,key <span style="color: #b16286;">(</span><span style="color: #fb4934;">quote</span> ,original-binding<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>base-buffer<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span>org-tree-view/is-tree-view<span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">setq</span> base-buffer <span style="color: #458588;">(</span>org-tree-view/make-base-buffer-name<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span>org-tree-view/has-tree-view<span style="color: #458588;">)</span>
          <span style="color: #458588;">(</span><span style="color: #fb4934;">setq</span> base-buffer <span style="color: #b16286;">(</span>current-buffer<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">when</span> <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">and</span> base-buffer <span style="color: #458588;">(</span>not <span style="color: #b16286;">(</span>string-match-p <span style="color: #b8bb26;">"mouse"</span> <span style="color: #8ec07c;">(</span>key-description key<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>message <span style="color: #b8bb26;">"Press %s again to close the tree view."</span> <span style="color: #458588;">(</span>key-description key<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>eval
       <span style="color: #458588;">(</span>macroexpand
        `<span style="color: #b16286;">(</span><span style="color: #fb4934;">progn</span>
           <span style="color: #8ec07c;">(</span>local-set-key ,key <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #458588;">()</span> <span style="color: #458588;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #458588;">)</span>
                                 ,reset-key
                                 <span style="color: #458588;">(</span>org-tree-view/close<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
           <span style="color: #8ec07c;">(</span>run-with-timer 1 nil <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #458588;">()</span>
                                   <span style="color: #458588;">(</span>message <span style="color: #b8bb26;">" "</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">clear</span>
                                   <span style="color: #458588;">(</span><span style="color: #fb4934;">with-current-buffer</span> ,base-buffer
                                     ,reset-key<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/open-headline-at-point</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> bind-close-after<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"From tree view, open headline at point in base buffer. If</span>
<span style="color: #b8bb26;">`</span><span style="color: #d3869b;">bind-close-after</span><span style="color: #b8bb26;">' is non-nil (default: t), the function will</span>
<span style="color: #b8bb26;">also call `</span><span style="color: #d3869b;">org-tree-view/bind-close-after</span><span style="color: #b8bb26;">' before finishing."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>bind-close-after <span style="color: #458588;">(</span><span style="color: #fb4934;">or</span> bind-close-after t<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>base-buffer <span style="color: #458588;">(</span>org-tree-view/make-base-buffer-name<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>position <span style="color: #458588;">(</span>get-text-property <span style="color: #b16286;">(</span>point<span style="color: #b16286;">)</span> 'org-tree-view-headline-pos<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">condition-case</span> nil
        <span style="color: #d65d0e;">(</span>select-window <span style="color: #458588;">(</span>car <span style="color: #b16286;">(</span>get-buffer-window-list base-buffer<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934; font-weight: bold;">error</span> <span style="color: #458588;">(</span>other-window 1<span style="color: #458588;">)</span>
             <span style="color: #458588;">(</span>switch-to-buffer base-buffer<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> position
        <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">progn</span> <span style="color: #458588;">(</span>widen<span style="color: #458588;">)</span>
               <span style="color: #458588;">(</span>goto-char position<span style="color: #458588;">)</span>
               <span style="color: #458588;">(</span>outline-show-all<span style="color: #458588;">)</span>
               <span style="color: #458588;">(</span>org-cycle-hide-drawers 'all<span style="color: #458588;">)</span>
               <span style="color: #458588;">(</span>org-narrow-to-subtree<span style="color: #458588;">)</span>
               <span style="color: #458588;">(</span><span style="color: #fb4934;">if</span> bind-close-after <span style="color: #b16286;">(</span>org-tree-view/bind-close-after<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934; font-weight: bold;">error</span> <span style="color: #b8bb26;">"No headline found!"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/switch-to-base-buffer</span> <span style="color: #b16286;">()</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">when</span> <span style="color: #8ec07c;">(</span>org-tree-view/is-tree-view<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span>get-buffer-window <span style="color: #458588;">(</span>org-tree-view/make-base-buffer-name<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span>select-window <span style="color: #458588;">(</span>get-buffer-window <span style="color: #b16286;">(</span>org-tree-view/make-base-buffer-name<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>other-window 1<span style="color: #d65d0e;">)</span>
      <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">FIXME: the following switch-to-buffer didn't work last I checked</span>
      <span style="color: #d65d0e;">(</span>switch-to-buffer <span style="color: #458588;">(</span>org-tree-view/make-base-buffer-name<span style="color: #458588;">)</span> nil <span style="color: #fe8019;">:force-same-window</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/toggle-visibility</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> arg<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"P"</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span>numberp arg<span style="color: #8ec07c;">)</span>
      <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">setq-local</span> org-tree-view/level arg<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span>/= org-tree-view/level <span style="color: #458588;">(</span>default-value 'org-tree-view/level<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">setq-local</span> org-tree-view/level <span style="color: #458588;">(</span>default-value 'org-tree-view/level<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">setq-local</span> org-tree-view/level 2<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>org-tree-view/refresh <span style="color: #fe8019;">:no-set-window-start</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>

<ul class="org-ul"><li><a id="org50f44c8"></a>Searching the tree view<br /><div class="outline-text-6" id="text-org50f44c8">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org8f385b6"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/self-insert-command</span> <span style="color: #b16286;">(</span>N<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Start an `</span><span style="color: #d3869b;">isearch</span><span style="color: #b8bb26;">' with the character `N' as the first</span>
<span style="color: #b8bb26;">character in the search."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"p"</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>goto-char <span style="color: #8ec07c;">(</span>point-min<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>char <span style="color: #458588;">(</span>string-to-char <span style="color: #b16286;">(</span>this-command-keys<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>unread-command-events <span style="color: #458588;">(</span>append unread-command-events <span style="color: #b16286;">(</span>list char<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>isearch-forward<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/isearch-return</span> <span style="color: #b16286;">()</span>
  <span style="color: #b8bb26;">"Open the matching headline and exit the isearch."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">when</span> <span style="color: #8ec07c;">(</span>org-tree-view/is-tree-view<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>org-tree-view/open-headline-at-point<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>run-with-timer 0 nil <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #458588;">()</span> <span style="color: #458588;">(</span>org-tree-view/bind-close-after <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"&lt;S-return&gt;"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">^ Timer needed because isearch-exit behaves weirdly otherwise.</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>inhibit-message t<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>isearch-exit<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div></li></ul>
</div>

<div id="outline-container-orga4cb620" class="outline-5">
<h5 id="orga4cb620">Helper functions</h5>
<div class="outline-text-5" id="text-orga4cb620">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org1cbe285"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/setup</span> <span style="color: #b16286;">()</span>
  <span style="color: #b16286;">(</span>font-lock-mode<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>org-tree-view/refresh<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq-local</span> buffer-read-only t<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq-local</span> scroll-margin 0<span style="color: #b16286;">)</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">If evil-mode is enabled, enable emacs state:</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">and</span> <span style="color: #d65d0e;">(</span>boundp 'evil-mode<span style="color: #d65d0e;">)</span> evil-mode<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>evil-emacs-state<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setq-local</span> case-fold-search t<span style="color: #b16286;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">ignore case</span>
  <span style="color: #b16286;">(</span>define-key isearch-mode-map <span style="color: #8ec07c;">(</span>kbd <span style="color: #b8bb26;">"&lt;S-return&gt;"</span><span style="color: #8ec07c;">)</span> #'org-tree-view/isearch-return<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/cleanup</span> <span style="color: #b16286;">()</span>
  <span style="color: #b16286;">(</span>define-key isearch-mode-map <span style="color: #8ec07c;">(</span>kbd <span style="color: #b8bb26;">"&lt;S-return&gt;"</span><span style="color: #8ec07c;">)</span> nil<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/make-base-buffer-name</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> tree-view-buffer<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>tree-view-buffer
         <span style="color: #458588;">(</span>get-buffer <span style="color: #b16286;">(</span><span style="color: #fb4934;">or</span> tree-view-buffer
                         <span style="color: #8ec07c;">(</span>current-buffer<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>string-remove-prefix <span style="color: #b8bb26;">"&lt;tree&gt;"</span> <span style="color: #d65d0e;">(</span>buffer-name tree-view-buffer<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/make-tree-view-buffer-name</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> base-buffer<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>base-buffer
         <span style="color: #458588;">(</span>get-buffer <span style="color: #b16286;">(</span><span style="color: #fb4934;">or</span> base-buffer
                         <span style="color: #8ec07c;">(</span>current-buffer<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>concat <span style="color: #b8bb26;">"&lt;tree&gt;"</span> <span style="color: #d65d0e;">(</span>buffer-name base-buffer<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/is-tree-view</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> buffer<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>buffer <span style="color: #458588;">(</span><span style="color: #fb4934;">or</span> buffer <span style="color: #b16286;">(</span>current-buffer<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">with-current-buffer</span> buffer
      <span style="color: #d65d0e;">(</span>bufferp <span style="color: #458588;">(</span>get-buffer <span style="color: #b16286;">(</span>org-tree-view/make-base-buffer-name buffer<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-tree-view/has-tree-view</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> buffer<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>buffer <span style="color: #458588;">(</span><span style="color: #fb4934;">or</span> buffer <span style="color: #b16286;">(</span>current-buffer<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">with-current-buffer</span> buffer
      <span style="color: #d65d0e;">(</span>bufferp <span style="color: #458588;">(</span>get-buffer <span style="color: #b16286;">(</span>org-tree-view/make-tree-view-buffer-name buffer<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org88d5e53" class="outline-5">
<h5 id="org88d5e53">Customizable options</h5>
<div class="outline-text-5" id="text-org88d5e53">
<p>
With <i>org-tree-view</i> looking more and more like a package, there are of course
options that can be set:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org7f9ddef"><span style="color: #458588;">(</span><span style="color: #fb4934;">defgroup</span> <span style="color: #d3869b;">org-tree-view</span> nil
  <span style="color: #b8bb26;">"A window providing easy access to all headings in an Org document."</span>
  <span style="color: #fe8019;">:group</span> 'org-mode<span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defcustom</span> <span style="color: #83a598;">org-tree-view/level</span> 3
  <span style="color: #b8bb26;">"The highest level headings to show in the tree view. Think of</span>
<span style="color: #b8bb26;">each asterisk preceding a heading as a level."</span>
  <span style="color: #fe8019;">:group</span> 'org-tree-view
  <span style="color: #fe8019;">:type</span> 'integer<span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defcustom</span> <span style="color: #83a598;">org-tree-view/width</span> 30
  <span style="color: #b8bb26;">"The width of the tree view window."</span>
  <span style="color: #fe8019;">:group</span> 'org-tree-view
  <span style="color: #fe8019;">:type</span> 'integer<span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defcustom</span> <span style="color: #83a598;">org-tree-view/side</span> 'left
  <span style="color: #b8bb26;">"The side on which to open the tree view window."</span>
  <span style="color: #fe8019;">:group</span> 'org-tree-view
  <span style="color: #fe8019;">:type</span> '<span style="color: #b16286;">(</span>radio
          <span style="color: #8ec07c;">(</span>const <span style="color: #fe8019;">:tag</span> <span style="color: #b8bb26;">"Left"</span> left<span style="color: #8ec07c;">)</span>
          <span style="color: #8ec07c;">(</span>const <span style="color: #fe8019;">:tag</span> <span style="color: #b8bb26;">"Right"</span> right<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defcustom</span> <span style="color: #83a598;">org-tree-view/open-key-binding</span> <span style="color: #b8bb26;">"C-c C-t"</span>
  <span style="color: #b8bb26;">"The key binding to open the tree view."</span>
  <span style="color: #fe8019;">:group</span> 'org-tree-view
  <span style="color: #fe8019;">:type</span> 'string
  <span style="color: #fe8019;">:set</span> <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">(</span>option value<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span>define-key org-mode-map <span style="color: #d65d0e;">(</span>kbd value<span style="color: #d65d0e;">)</span>
           #'org-tree-view/open<span style="color: #8ec07c;">)</span>
         <span style="color: #8ec07c;">(</span>define-key org-tree-view-mode-map <span style="color: #d65d0e;">(</span>kbd value<span style="color: #d65d0e;">)</span>
           #'org-tree-view/switch-to-base-buffer<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Define org-tree-view/level-N faces</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">dotimes</span> <span style="color: #b16286;">(</span>i 8<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>num <span style="color: #458588;">(</span>number-to-string <span style="color: #b16286;">(</span>1+ i<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>org-tree-view-face <span style="color: #458588;">(</span>intern <span style="color: #b16286;">(</span>concat <span style="color: #b8bb26;">"org-tree-view/level-"</span> num<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>org-face <span style="color: #458588;">(</span>intern <span style="color: #b16286;">(</span>concat <span style="color: #b8bb26;">"org-level-"</span> num<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>eval <span style="color: #d65d0e;">(</span>macroexpand
           `<span style="color: #458588;">(</span><span style="color: #fb4934;">defface</span> ,org-tree-view-face
              '<span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>t . <span style="color: #d65d0e;">(</span><span style="color: #fe8019;">:inherit</span> ,org-face<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
              <span style="color: #b16286;">(</span>format <span style="color: #b8bb26;">"Face for level %s headlines."</span> num<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe564b2" class="outline-5">
<h5 id="orgbe564b2">Issues</h5>
<div class="outline-text-5" id="text-orgbe564b2">
<ul class="org-ul">
<li>Currently, after making edits with the tree view open, it seems that
<code>org-tree-view/open-headline-at-point</code> will, for many headlines, move to the
wrong position in the base buffer. Upon closing and re-opening the tree view,
the bug disappears.</li>
</ul>
</div>
</div>

<div id="outline-container-org3a43ecb" class="outline-5">
<h5 id="org3a43ecb">Planned features</h5>
<div class="outline-text-5" id="text-org3a43ecb">
<ul class="org-ul">
<li>Keyword integration (TODO, DONE, &#x2026;)</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgf572531" class="outline-4">
<h4 id="org-make-wiktionary-link"><a id="orgf572531"></a>Automatic Wiktionary links</h4>
<div class="outline-text-4" id="text-org-make-wiktionary-link">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgc36aabe"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-make-wiktionary-link</span> <span style="color: #b16286;">(</span>string <span style="color: #d3869b;">&amp;optional</span> from to<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Wraps the word at point or selected word in a Wiktionary link to the word."</span>

  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">(see http://ergoemacs.org/emacs/elisp_command_working_on_string_or_region.html)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span>
   <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span>use-region-p<span style="color: #d65d0e;">)</span>
       <span style="color: #d65d0e;">(</span>list nil <span style="color: #458588;">(</span>region-beginning<span style="color: #458588;">)</span> <span style="color: #458588;">(</span>region-end<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
     <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">let</span> <span style="color: #458588;">(</span><span style="color: #b16286;">(</span>bds <span style="color: #8ec07c;">(</span>bounds-of-thing-at-point 'word<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span> <span style="color: #458588;">)</span>
       <span style="color: #458588;">(</span>list nil <span style="color: #b16286;">(</span>car bds<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>cdr bds<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>wiktionary-language
         <span style="color: #458588;">(</span><span style="color: #fb4934;">if</span> <span style="color: #b16286;">(</span>boundp 'wiktionary-language<span style="color: #b16286;">)</span> wiktionary-language 'russian<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>input  <span style="color: #b16286;">(</span><span style="color: #fb4934;">or</span> string <span style="color: #8ec07c;">(</span>buffer-substring-no-properties from to<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
           <span style="color: #458588;">(</span>output <span style="color: #b16286;">(</span>concat <span style="color: #b8bb26;">"[[https://en.wiktionary.org/wiki/"</span>
                           <span style="color: #8ec07c;">(</span>org-link-escape <span style="color: #d65d0e;">(</span>downcase input<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
                           <span style="color: #b8bb26;">"#"</span>
                           <span style="color: #8ec07c;">(</span>capitalize <span style="color: #d65d0e;">(</span>symbol-name wiktionary-language<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
                           <span style="color: #b8bb26;">"]["</span>
                           input
                           <span style="color: #b8bb26;">"]]"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>delete-region from to<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>goto-char from<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>insert output<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>define-key org-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"C-c L"</span><span style="color: #b16286;">)</span> #'org-make-wiktionary-link<span style="color: #458588;">)</span>
</pre>
</div>

<p>
Above is the definition for my custom <code>org-make-wiktionary-link</code> function. Like
the description says, it creates a link to the Wiktionary entry on the selected
word (or, if no region is active, the word where the cursor is). Furthermore, I
have set it to always bring up the Russian definition, but if you copy this
function to your own configuration, you can just set <code>wiktionary-language</code> to
<code>'english</code> or something, or even <code>'non-existent-language</code> if you don&rsquo;t want to look
up any specific language.
</p>

<p>
I have written it because I study Russian and write down all the words I
learn in an Org file. For more language-related settings, see the section
on <a href="#lang">non-English languages</a>.
</p>
</div>
</div>

<div id="outline-container-org0693839" class="outline-4">
<h4 id="org0693839">Tangling my configuration</h4>
<div class="outline-text-4" id="text-org0693839">
<p>
Because I keep my Emacs configuration in an Org document, I need a quick and
easy way to have <code>org-babel</code> <i>tangle</i> my configuration to <code>config.el</code>, which is loaded
by Emacs at startup.
</p>

<p>
This Org document is full of code blocks that shouldn&rsquo;t be tangled. It&rsquo;s also
full of source blocks that <i>should</i> be tangled, but not whenever I want to update
my configuration.
</p>

<p>
This is a problem, because there is no built-in function to tangle a source
block by name, for example. So I wrote the following function to automatically
do it for me.
</p>

<p>
Obviously, it&rsquo;s highly personalized and depends on there only being one code
block with the name <code>c:config-all</code>, so if you copy this function, you should
probably edit that.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgabf4ed0"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-babel-tangle-config</span> <span style="color: #b16286;">()</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>tangle-buffer <span style="color: #458588;">(</span>clone-indirect-buffer <span style="color: #b8bb26;">"&lt;tangle&gt;config"</span> nil <span style="color: #fe8019;">:norecord</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">with-current-buffer</span> tangle-buffer
      <span style="color: #d65d0e;">(</span>widen<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>goto-char <span style="color: #458588;">(</span>org-babel-find-named-block <span style="color: #b8bb26;">"c:config-all"</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">let</span> <span style="color: #458588;">(</span><span style="color: #b16286;">(</span>current-prefix-arg '<span style="color: #8ec07c;">(</span>4<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span>call-interactively #'org-babel-tangle<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>kill-buffer tangle-buffer<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>byte-compile-file <span style="color: #b8bb26;">"config.el"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>define-key org-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"C-c C-v M-t"</span><span style="color: #b16286;">)</span> #'org-babel-tangle-config<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org70496bb" class="outline-4">
<h4 id="org-beginning-of-line"><a id="org70496bb"></a>Adjusting <i>org-beginning-of-line</i></h4>
<div class="outline-text-4" id="text-org-beginning-of-line">
<p>
I know the following code will look hectic, but it&rsquo;s quite simple. You only need
to pay attention to a couple of lines. You see, this is the
<code>org-beginning-of-line</code> function, copied from the Org source, but modified to use
a function in my Emacs configuration called <code>smarter-beginning-of-line</code>, based on
the function with the same name <a href="http://emacsredux.com/blog/2013/05/22/smarter-navigation-to-the-beginning-of-a-line/">written by Bozhidar Batsov</a> of Emacs Redux. For
my implementation of it, see the section on <a href="#beginning-end-of-line">making C-a smarter</a>. In a nutshell,
it moves to indentation unless the point is already at indentation, in which
case it moves to the true beginning of line.
</p>

<p>
Let&rsquo;s have a look at the code and then I&rsquo;ll explain it.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org78d3461"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">org-smarter-beginning-of-line</span> <span style="color: #b16286;">(</span>original-function <span style="color: #d3869b;">&amp;optional</span> n<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"The exact same function as `</span><span style="color: #d3869b;">org-beginning-of-line</span><span style="color: #b8bb26;">',</span>
<span style="color: #b8bb26;">but with one exception: instead of calling `</span><span style="color: #d3869b;">beginning-of-line</span><span style="color: #b8bb26;">'</span>
<span style="color: #b8bb26;">twice, it calls `</span><span style="color: #d3869b;">smarter-beginning-of-line</span><span style="color: #b8bb26;">' once."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span> <span style="color: #b8bb26;">"^p"</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>origin <span style="color: #458588;">(</span>point<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span>special <span style="color: #458588;">(</span><span style="color: #fb4934;">pcase</span> org-special-ctrl-a/e
                   <span style="color: #b16286;">(</span>`<span style="color: #8ec07c;">(</span>,C-a . ,_<span style="color: #8ec07c;">)</span> C-a<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>_ org-special-ctrl-a/e<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
        deactivate-mark<span style="color: #8ec07c;">)</span>
    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">First move to a visible line.</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">bound-and-true-p</span> visual-line-mode<span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span>beginning-of-visual-line n<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>smarter-move-beginning-of-line n<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">cond</span>
     <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">No special behavior.  Point is already at the beginning of</span>
     <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">a line, logical or visual.</span>
     <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>not special<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
     <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">`</span><span style="color: #d3869b;">beginning-of-visual-line</span><span style="color: #7c6f64;">' left point before logical beginning</span>
     <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">of line: point is at the beginning of a visual line.  Bail</span>
     <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">out.</span>
     <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span><span style="color: #fb4934;">and</span> <span style="color: #b16286;">(</span><span style="color: #fb4934;">bound-and-true-p</span> visual-line-mode<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>not <span style="color: #8ec07c;">(</span>bolp<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
     <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span><span style="color: #fb4934;">let</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>case-fold-search nil<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>looking-at org-complex-heading-regexp<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
      <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">At a headline, special position is before the title, but</span>
      <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">after any TODO keyword or priority cookie.</span>
      <span style="color: #458588;">(</span><span style="color: #fb4934;">let</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>refpos <span style="color: #d65d0e;">(</span>min <span style="color: #458588;">(</span>1+ <span style="color: #458588;">(</span><span style="color: #fb4934;">or</span> <span style="color: #b16286;">(</span>match-end 3<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>match-end 2<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>match-end 1<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #458588;">)</span>
                         <span style="color: #458588;">(</span>line-end-position<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
            <span style="color: #8ec07c;">(</span>bol <span style="color: #d65d0e;">(</span>point<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
        <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span>eq special 'reversed<span style="color: #8ec07c;">)</span>
            <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">when</span> <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">and</span> <span style="color: #458588;">(</span>= origin bol<span style="color: #458588;">)</span> <span style="color: #458588;">(</span>eq last-command this-command<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
              <span style="color: #d65d0e;">(</span>goto-char refpos<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
          <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">when</span> <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">or</span> <span style="color: #458588;">(</span>&gt; origin refpos<span style="color: #458588;">)</span> <span style="color: #458588;">(</span>= origin bol<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
            <span style="color: #d65d0e;">(</span>goto-char refpos<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
     <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span><span style="color: #fb4934;">and</span> <span style="color: #b16286;">(</span>looking-at org-list-full-item-re<span style="color: #b16286;">)</span>
           <span style="color: #b16286;">(</span>memq <span style="color: #8ec07c;">(</span>org-element-type <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">save-match-data</span> <span style="color: #458588;">(</span>org-element-at-point<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
                 '<span style="color: #8ec07c;">(</span>item plain-list<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
      <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Set special position at first white space character after</span>
      <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">bullet, and check-box, if any.</span>
      <span style="color: #458588;">(</span><span style="color: #fb4934;">let</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>after-bullet
             <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">let</span> <span style="color: #458588;">(</span><span style="color: #458588;">(</span>box <span style="color: #b16286;">(</span>match-end 3<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #458588;">)</span>
               <span style="color: #458588;">(</span><span style="color: #fb4934;">cond</span> <span style="color: #458588;">(</span><span style="color: #b16286;">(</span>not box<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>match-end 1<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
                     <span style="color: #458588;">(</span><span style="color: #b16286;">(</span>eq <span style="color: #8ec07c;">(</span>char-after box<span style="color: #8ec07c;">)</span> ?\s<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>1+ box<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
                     <span style="color: #458588;">(</span>t box<span style="color: #458588;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
        <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span>eq special 'reversed<span style="color: #8ec07c;">)</span>
            <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">when</span> <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">and</span> <span style="color: #458588;">(</span>= <span style="color: #458588;">(</span>point<span style="color: #458588;">)</span> origin<span style="color: #458588;">)</span> <span style="color: #458588;">(</span>eq last-command this-command<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
              <span style="color: #d65d0e;">(</span>goto-char after-bullet<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
          <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">when</span> <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">or</span> <span style="color: #458588;">(</span>&gt; origin after-bullet<span style="color: #458588;">)</span> <span style="color: #458588;">(</span>= <span style="color: #458588;">(</span>point<span style="color: #458588;">)</span> origin<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
            <span style="color: #d65d0e;">(</span>goto-char after-bullet<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
     <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">No special context.  Point is already at beginning of line.</span>
     <span style="color: #d65d0e;">(</span>t nil<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>advice-add 'org-beginning-of-line <span style="color: #fe8019;">:around</span> #'org-smarter-beginning-of-line<span style="color: #458588;">)</span>
</pre>
</div>

<p>
So why all this code?
</p>

<p>
First of all, Org-mode has its own function for moving to the beginning of the
line, and if you set enable <code>org-special-ctrl-a/e</code>, it is really useful. For that
reason, I want to use Org&rsquo;s own function, but force it to use
<code>smarter-beginning-of-line</code> instead of <code>beginning-of-line</code>.
</p>

<p>
Now, this <i>should</i> be as easy as just replacing the <code>beginning-of-line</code> function
with <code>smarter-beginning-of-line</code>, but unfortunately this doesn&rsquo;t work, because
<code>org-beginning-of-line</code> stupidly calls <code>beginning-of-line</code> <i>twice</i>!
</p>

<p>
This will not work with <code>smarter-beginning-of-line</code>, because calling that function
twice will always move the cursor to the actual beginning of line, and never it
will never move to the indentation, which sort of is the point of the entire
function.
</p>

<p>
The easiest way to solve the problem is, unfortunately, copying the
<code>org-beginning-of-line</code> function definition and modifying it to call
<code>move-beginning-of-line</code> only <i>once</i>. Or in my case, <code>smarter-beginning-of-line</code>,
once.
</p>

<p>
This works well, but of course it will block any potential future changes to
<code>org-beginning-of-line</code> by the Org developers. On the other hand, it&rsquo;s unlikely
that such a basic and well-working function should recieve any significant
updates.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd079dd6" class="outline-3">
<h3 id="racket-mode"><a id="orgd079dd6"></a><span class="section-number-3">8.2</span> Racket</h3>
<div class="outline-text-3" id="text-racket-mode">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org85e77fb"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> racket-mode
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #fe8019;">:map</span> racket-repl-mode-map
              <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"&lt;f5&gt;"</span> . /racket-repl-run<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #fe8019;">:map</span> racket-mode-map
              <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"&lt;S-f5&gt;"</span> . /racket-interrupt-run<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #fe8019;">:config</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">/racket-repl-run</span> <span style="color: #8ec07c;">()</span>
    <span style="color: #b8bb26;">"From any buffer (usually the Racket REPL buffer), run the</span>
<span style="color: #b8bb26;">    Racket program in the first buffer found whose name ends with</span>
<span style="color: #b8bb26;">    \".rkt\"."</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>rkt-buffer <span style="color: #b16286;">(</span>car <span style="color: #8ec07c;">(</span>cl-remove-if-not
                            <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #458588;">(</span>buffer<span style="color: #458588;">)</span>
                              <span style="color: #458588;">(</span>string-suffix-p <span style="color: #b8bb26;">".rkt"</span> <span style="color: #458588;">(</span>buffer-name buffer<span style="color: #458588;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
                            <span style="color: #d65d0e;">(</span>buffer-list<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">assume first .rkt buffer</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">with-current-buffer</span> rkt-buffer
        <span style="color: #458588;">(</span>racket-run<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">/racket-interrupt-run</span> <span style="color: #8ec07c;">()</span>
    <span style="color: #b8bb26;">"Run the Racket program in the current buffer, after sending</span>
<span style="color: #b8bb26;">    an interrupt signal to the Racket REPL (C-c)."</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">with-current-buffer</span> racket--repl-buffer-name
      <span style="color: #d65d0e;">(</span>comint-interrupt-subjob<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>racket-run<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'racket-repl-mode-hook #'toggle-truncate-lines<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c20bb6" class="outline-3">
<h3 id="org7c20bb6"><span class="section-number-3">8.3</span> LaTeX</h3>
<div class="outline-text-3" id="text-8-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org38daa38"><span style="color: #458588;">(</span><span style="color: #fb4934;">use-package</span> tex
  <span style="color: #fe8019;">:defer</span> t
  <span style="color: #fe8019;">:ensure</span> auctex
  <span style="color: #fe8019;">:config</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">require</span> '<span style="color: #d3869b;">auctex-latexmk</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>auctex-latexmk-setup<span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">/start-update-viewer</span> <span style="color: #8ec07c;">()</span>
    <span style="color: #b8bb26;">"Starts/updates PDF viewer."</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span>string-match <span style="color: #b8bb26;">"no process found"</span>
                      <span style="color: #458588;">(</span>shell-command-to-string <span style="color: #b8bb26;">"killall -HUP mupdf-x11"</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
        <span style="color: #d65d0e;">(</span><span style="color: #fb4934; font-weight: bold;">error</span> <span style="color: #b8bb26;">"PDF viewer is not running"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">/run-view</span> <span style="color: #8ec07c;">()</span>
    <span style="color: #b8bb26;">"Saves the current LaTeX document, processes it and finally runs it."</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>save-buffer<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>process <span style="color: #b16286;">(</span>TeX-run-TeX <span style="color: #b8bb26;">"LaTeX"</span>
                                <span style="color: #8ec07c;">(</span>format <span style="color: #b8bb26;">"latexmk -xelatex %s"</span> <span style="color: #d65d0e;">(</span>buffer-file-name<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
                                <span style="color: #8ec07c;">(</span>file-name-base <span style="color: #d65d0e;">(</span>buffer-file-name<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>set-process-sentinel process <span style="color: #458588;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #b16286;">(</span>process sentinel<span style="color: #b16286;">)</span>
                                      <span style="color: #b16286;">(</span><span style="color: #fb4934;">when</span> <span style="color: #8ec07c;">(</span>= 0 <span style="color: #d65d0e;">(</span>process-exit-status process<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
                                        <span style="color: #8ec07c;">(</span>/start-update-viewer<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">/view-after-run</span> <span style="color: #8ec07c;">(</span><span style="color: #d3869b;">&amp;rest</span> r<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>/start-update-viewer<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span>advice-add #'Latexmk-sentinel <span style="color: #fe8019;">:after</span> #'/view-after-run<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'TeX-mode-hook <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #d65d0e;">()</span> <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">setf</span> TeX-command-default <span style="color: #b8bb26;">"LatexMk"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>

  <span style="color: #fe8019;">:bind</span> <span style="color: #b16286;">(</span><span style="color: #fe8019;">:map</span> LaTeX-mode-map
              <span style="color: #8ec07c;">(</span><span style="color: #b8bb26;">"C-c C-u"</span> . /start-update-viewer<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1fd1294" class="outline-3">
<h3 id="org1fd1294"><span class="section-number-3">8.4</span> Python</h3>
<div class="outline-text-3" id="text-8-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org42e3557"><span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">python-mode</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">shell-compile</span> <span style="color: #b16286;">()</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">(courtesy of djangoliv @ stack interchange)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>shell-command <span style="color: #8ec07c;">(</span>concat <span style="color: #b8bb26;">"python "</span> <span style="color: #d65d0e;">(</span>buffer-file-name<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span>&lt;= <span style="color: #d65d0e;">(</span>* 2 <span style="color: #458588;">(</span>window-height<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span> <span style="color: #d65d0e;">(</span>frame-height<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
      <span style="color: #8ec07c;">(</span>enlarge-window 20<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>/ <span style="color: #d65d0e;">(</span>frame-height<span style="color: #d65d0e;">)</span> 2<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>add-hook 'python-mode-hook
          '<span style="color: #b16286;">(</span>lambda <span style="color: #8ec07c;">()</span>
             <span style="color: #8ec07c;">(</span>define-key python-mode-map <span style="color: #d65d0e;">(</span>kbd <span style="color: #b8bb26;">"C-c C-c"</span><span style="color: #d65d0e;">)</span> 'shell-compile<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-orgec9f463" class="outline-2">
<h2 id="e-mail"><a id="orgec9f463"></a><span class="section-number-2">9</span> E-mail</h2>
<div class="outline-text-2" id="text-e-mail">
<p>
Because I like living in Emacs, I like to read my e-mail in Emacs.
</p>
</div>

<div id="outline-container-org38deb01" class="outline-3">
<h3 id="org38deb01"><span class="section-number-3">9.1</span> Gnus</h3>
<div class="outline-text-3" id="text-9-1">
<p>
For my Gnus configuration, see the <code>gnus/gnus.el</code> file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgc6bb404"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">gnus-dir</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> path<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>concat user-emacs-directory <span style="color: #b8bb26;">"gnus/"</span> path<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> gnus-init-file <span style="color: #b16286;">(</span>gnus-dir <span style="color: #b8bb26;">"gnus.el"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca6a54e" class="outline-3">
<h3 id="orgca6a54e"><span class="section-number-3">9.2</span> <i>notmuch</i></h3>
<div class="outline-text-3" id="text-9-2">
<p>
<b>Note to self:</b> Should this configuration even be stored in this document?
Probably not. It is more suitable as part of a blog post. Now I just need to
start a blog &#x2026;
</p>
</div>


<div id="outline-container-org02f6c20" class="outline-4">
<h4 id="org02f6c20">Personal <i>mail</i> shell script</h4>
<div class="outline-text-4" id="text-org02f6c20">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #fb4934;">case</span> $<span style="color: #83a598;">1</span><span style="color: #fb4934;"> in</span>
    pull)
        mbsync -a;
        <span style="color: #fe8019;">echo</span> <span style="color: #b8bb26;">"Press any key to continue..."</span>;
        <span style="color: #fe8019;">read</span>; <span style="color: #7c6f64;"># </span><span style="color: #7c6f64;">in case mbsync fails, give user chance to abort and try again</span>
        notmuch new;
        afew --tag --new;;
    push)
        afew --move-mail --new;
        mbsync -a;;
    *)
        <span style="color: #fe8019;">echo</span> <span style="color: #b8bb26;">"Usage: mail {pull|push}"</span>;
        <span style="color: #fb4934;">exit</span> 1;;
<span style="color: #fb4934;">esac</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4d7ff5" class="outline-4">
<h4 id="orga4d7ff5">Refresh status message</h4>
<div class="outline-text-4" id="text-orga4d7ff5">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org6dffd89"><span style="color: #458588;">(</span><span style="color: #fb4934;">defvar</span> <span style="color: #83a598;">notmuch-hello-refresh-count</span> 0<span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">notmuch-hello-refresh-status-message</span> <span style="color: #b16286;">()</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>new-count
          <span style="color: #458588;">(</span>string-to-number
           <span style="color: #b16286;">(</span>car <span style="color: #8ec07c;">(</span>process-lines notmuch-command <span style="color: #b8bb26;">"count"</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>diff-count <span style="color: #458588;">(</span>- new-count notmuch-hello-refresh-count<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">cond</span>
      <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>= notmuch-hello-refresh-count 0<span style="color: #458588;">)</span>
       <span style="color: #458588;">(</span>message <span style="color: #b8bb26;">"You have %s messages."</span>
                <span style="color: #b16286;">(</span>notmuch-hello-nice-number new-count<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>&gt; diff-count 0<span style="color: #458588;">)</span>
       <span style="color: #458588;">(</span>message <span style="color: #b8bb26;">"You have %s more messages since last refresh."</span>
                <span style="color: #b16286;">(</span>notmuch-hello-nice-number diff-count<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>&lt; diff-count 0<span style="color: #458588;">)</span>
       <span style="color: #458588;">(</span>message <span style="color: #b8bb26;">"You have %s fewer messages since last refresh."</span>
                <span style="color: #b16286;">(</span>notmuch-hello-nice-number <span style="color: #8ec07c;">(</span>- diff-count<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">setq</span> notmuch-hello-refresh-count new-count<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>add-hook 'notmuch-hello-refresh-hook 'notmuch-hello-refresh-status-message<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga1fec13" class="outline-4">
<h4 id="orga1fec13">Helm completion</h4>
<div class="outline-text-4" id="text-orga1fec13">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgc921c89"><span style="color: #458588;">(</span><span style="color: #fb4934;">setq</span> notmuch-address-selection-function
      <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">(</span>prompt collection initial-input<span style="color: #8ec07c;">)</span>
        <span style="color: #8ec07c;">(</span>completing-read prompt <span style="color: #d65d0e;">(</span>cons initial-input collection<span style="color: #d65d0e;">)</span> nil t nil 'notmuch-address-history<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
This does not seem to work.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org215618d" class="outline-2">
<h2 id="custom-hooks"><a id="org215618d"></a><span class="section-number-2">10</span> Custom hooks</h2>
<div class="outline-text-2" id="text-custom-hooks">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org8253db6"><span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">window-focus-out-hook, window-focus-in-hook</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">run-window-focus-out-hook</span> <span style="color: #b16286;">(</span>window <span style="color: #d3869b;">&amp;optional</span> norecord<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>run-hooks 'window-focus-out-hook<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">run-window-focus-in-hook</span> <span style="color: #b16286;">(</span>window <span style="color: #d3869b;">&amp;optional</span> norecord<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>run-hooks 'window-focus-in-hook<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>advice-add 'select-window <span style="color: #fe8019;">:before</span> 'run-window-focus-out-hook<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>advice-add 'select-window <span style="color: #fe8019;">:after</span> 'run-window-focus-in-hook<span style="color: #458588;">)</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">NOTE: This doesn't always play nice with magit. For example, select-window</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">seems to be run when opening the commit message buffer, but *not* when</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">returning to the magit status buffer. I'm not quite sure why, but I suppose I</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">could add an exception for it. I'd have to look at the magit source. Perhaps</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">I could just run a function upon switch-to-buffer that checks whether the</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">current-window is different from the previous-current-window (saved in a</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">variable); that might be the most simple solution, similar to what hl-line</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">does, but as I've said before, more efficient than attaching everything to</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">post-command-hook ...</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">TODO: Add exception for magit buffer switching.</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">before-minibuffer-hook, after-minibuffer-hook</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">run-before-minibuffer-hook</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> <span style="color: #d3869b;">&amp;rest</span> args<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>run-hooks 'before-minibuffer-hook<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>add-hook 'post-command-hook 'run-after-minibuffer-hook<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">run-after-minibuffer-hook</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> <span style="color: #d3869b;">&amp;rest</span> args<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">unless</span> <span style="color: #8ec07c;">(</span>minibufferp<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>run-hooks 'after-minibuffer-hook<span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span>remove-hook 'post-command-hook 'run-after-minibuffer-hook<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>advice-add 'read-from-minibuffer <span style="color: #fe8019;">:before</span> 'run-before-minibuffer-hook<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>advice-add 'read-no-blanks-input <span style="color: #fe8019;">:before</span> 'run-before-minibuffer-hook<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>advice-add 'read-string          <span style="color: #fe8019;">:before</span> 'run-before-minibuffer-hook<span style="color: #458588;">)</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">before-helm-hook, after-helm-hook</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">run-before-helm-hook</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> <span style="color: #d3869b;">&amp;rest</span> args<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>run-hooks 'before-helm-hook<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">run-after-helm-hook</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> <span style="color: #d3869b;">&amp;rest</span> args<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span>run-hooks 'after-helm-hook<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>add-hook 'helm-before-initialize-hook 'run-before-helm-hook<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>add-hook 'helm-exit-minibuffer-hook   'run-after-helm-hook<span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>advice-add 'helm-keyboard-quit <span style="color: #fe8019;">:after</span> 'run-after-helm-hook<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orge3d088e" class="outline-2">
<h2 id="visuals"><a id="orge3d088e"></a><span class="section-number-2">11</span> Visuals</h2>
<div class="outline-text-2" id="text-visuals">
</div>

<div id="outline-container-orga39d29d" class="outline-3">
<h3 id="orga39d29d"><span class="section-number-3">11.1</span> Theme configuration</h3>
<div class="outline-text-3" id="text-11-1">
<p>
I like to be flexible when it comes to themes. For example, I want to be able to
switch themes in the middle of a session without any issues. I also want Emacs
to automatically load a sensible theme depending on the amount of daylight.
Furthermore, I want to be able to easily adjust the themes I use, because they
aren&rsquo;t perfect.
</p>

<p>
I believe I have succeeded in achieving my goals, and rather nicely at that.
</p>
</div>

<div id="outline-container-orgefacfcb" class="outline-4">
<h4 id="daylight-sets-color"><a id="orgefacfcb"></a>Daylight-dependent default theme</h4>
<div class="outline-text-4" id="text-daylight-sets-color">
<p>
This is a function that I have ported from my old <code>vimrc</code>. It relies on <code>sun</code>, a
highly personalized script of which I am <i>not</i> particularly proud, because of how
ugly it is &#x2026; But if you absolutely <i>have</i> to see it, it&rsquo;s available at <a href="https://github.com/jocap/uppsala-sun">GitHub</a> -
you&rsquo;ve been warned.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgaadc36e"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">daylight-sets-color</span> <span style="color: #b16286;">()</span>
  <span style="color: #b8bb26;">"Sets a light theme for day and a dark theme for night.</span>
<span style="color: #b8bb26;">Depends on the script `</span><span style="color: #d3869b;">sun</span><span style="color: #b8bb26;">' being found in path."</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>time <span style="color: #458588;">(</span>string-to-number <span style="color: #b16286;">(</span>format-time-string <span style="color: #b8bb26;">"%H.%M"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
        <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">if</span> <span style="color: #d65d0e;">(</span>string-match <span style="color: #b8bb26;">"not found"</span> <span style="color: #458588;">(</span>shell-command-to-string <span style="color: #b8bb26;">"which sun"</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
            <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span><span style="color: #fb4934;">and</span> <span style="color: #b16286;">(</span>&gt; time 6.00<span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span>&lt; time 18.00<span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">default if `</span><span style="color: #d3869b;">sun</span><span style="color: #7c6f64;">' not found</span>
                <span style="color: #458588;">(</span>load-theme light-theme t<span style="color: #458588;">)</span>
              <span style="color: #458588;">(</span>load-theme dark-theme t<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
          <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">let</span> <span style="color: #458588;">(</span><span style="color: #b16286;">(</span>sunrise
                 <span style="color: #8ec07c;">(</span>string-to-number <span style="color: #d65d0e;">(</span>shell-command-to-string <span style="color: #b8bb26;">"sun _rise"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
                <span style="color: #b16286;">(</span>sunset
                 <span style="color: #8ec07c;">(</span>string-to-number <span style="color: #d65d0e;">(</span>shell-command-to-string <span style="color: #b8bb26;">"sun _set"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
            <span style="color: #458588;">(</span><span style="color: #fb4934;">if</span> <span style="color: #b16286;">(</span><span style="color: #fb4934;">and</span> <span style="color: #8ec07c;">(</span>&gt; time sunrise<span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>&lt; time sunset<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
                <span style="color: #b16286;">(</span>load-theme light-theme t<span style="color: #b16286;">)</span>
              <span style="color: #b16286;">(</span>load-theme dark-theme t<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
The function depends on the following variables being set:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgcbe4a02"><span style="color: #458588;">(</span><span style="color: #fb4934;">setf</span> light-theme 'leuven
      dark-theme  'gruvbox-dark-hard<span style="color: #458588;">)</span>
</pre>
</div>

<p>
To set the default theme on startup, I use the following code:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org03e9a70"><span style="color: #458588;">(</span>add-hook 'after-init-hook 'daylight-sets-color<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org69387fc" class="outline-4">
<h4 id="dynamic-theme-settings"><a id="org69387fc"></a>Dynamic theme settings</h4>
<div class="outline-text-4" id="text-dynamic-theme-settings">
<p>
Another of my goals was being able to easily adjust the colors of individual
themes. While my solution may not be &ldquo;simple,&rdquo; it is efficient and easy to use.
</p>

<p>
The way I have it set up is that every time a theme is loaded, a function called
<code>theme-do-all</code> is run:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org2fc91b1"><span style="color: #458588;">(</span>advice-add 'load-theme <span style="color: #fe8019;">:after</span> <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">(</span>theme <span style="color: #d3869b;">&amp;optional</span> rest ...<span style="color: #8ec07c;">)</span>
                                 <span style="color: #8ec07c;">(</span>theme-do-all theme<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>

<p>
The <code>theme-do-all</code> function contains a bunch of different settings: some for all
themes, some only for specific themes.
</p>

<p>
The more interesting aspect of the function, however, is the way it sets up
<i>dynamic colors</i>, dependent on the colors of the loaded theme. For example, I
don&rsquo;t set a custom <code>fci-rule-color</code> (that&rsquo;s <i>fill-column-indicator</i>) for every
theme. Instead, I base it on the background color of the loaded theme, making it
stick out just enough to be distinguishable. This way, I can load <i>any</i> theme and
the <code>fci-rule-color</code> will automatically be set to a sensible color.
</p>

<p>
To achieve this, I use the <code>color</code> functions. I also define my own <code>intensify</code> and
<code>anti-intensify</code> functions, which depend on the lightness of the theme&rsquo;s
background.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org4128339"><span style="color: #458588;">(</span><span style="color: #fb4934;">defvar</span> <span style="color: #83a598;">current-theme</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">theme-do-all</span> <span style="color: #b16286;">(</span>theme<span style="color: #b16286;">)</span>
  <span style="color: #b8bb26;">"Actions to perform whenever a theme is loaded."</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">setf</span> current-theme theme<span style="color: #b16286;">)</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">require</span> '<span style="color: #d3869b;">color</span><span style="color: #b16286;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">for color-* functions</span>

  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>bg
          <span style="color: #458588;">(</span>alist-get 'background-mode <span style="color: #b16286;">(</span>frame-parameters<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>intensify
          <span style="color: #458588;">(</span><span style="color: #fb4934;">if</span> <span style="color: #b16286;">(</span>eq bg 'dark<span style="color: #b16286;">)</span> 'color-darken-name 'color-lighten-name<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
         <span style="color: #d65d0e;">(</span>anti-intensify
          <span style="color: #458588;">(</span><span style="color: #fb4934;">if</span> <span style="color: #b16286;">(</span>eq bg 'dark<span style="color: #b16286;">)</span> 'color-lighten-name 'color-darken-name<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Settings for all themes</span>
    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">***********************</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">* Dynamic mouse pointer color</span>
    <span style="color: #8ec07c;">(</span>set-mouse-color
     <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span>eq bg 'dark<span style="color: #458588;">)</span> <span style="color: #b8bb26;">"#ffffff"</span> <span style="color: #b8bb26;">"#000000"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">* fci-rule-color -&gt; desaturate, anti-intensity</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">setq</span> fci-rule-color <span style="color: #d65d0e;">(</span>color-desaturate-name
                          <span style="color: #458588;">(</span>funcall anti-intensify
                                   <span style="color: #b16286;">(</span>face-attribute 'default <span style="color: #fe8019;">:background</span><span style="color: #b16286;">)</span> 15<span style="color: #458588;">)</span> <span style="color: #fb4934; font-weight: bold;">50</span><span style="color: #d65d0e; font-weight: bold;">)</span><span style="color: #8ec07c; font-weight: bold;">)</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">* org-block-background -&gt; desaturate, darken</span>
    <span style="color: #8ec07c;">(</span>set-face-attribute 'org-block nil
                        <span style="color: #fe8019;">:background</span> <span style="color: #d65d0e;">(</span>color-desaturate-name
                                     <span style="color: #458588;">(</span>color-darken-name
                                      <span style="color: #b16286;">(</span>face-attribute 'default <span style="color: #fe8019;">:background</span><span style="color: #b16286;">)</span> 3<span style="color: #458588;">)</span> <span style="color: #fb4934; font-weight: bold;">20</span><span style="color: #d65d0e; font-weight: bold;">)</span>
                        <span style="color: #fe8019;">:foreground</span> <span style="color: #d65d0e;">(</span>face-attribute 'default <span style="color: #fe8019;">:foreground</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">* org-block-begin-line, org-block-end-line</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">cl-loop</span>
       for face in '<span style="color: #d65d0e;">(</span>org-block-begin-line org-block-end-line<span style="color: #d65d0e;">)</span>
       do <span style="color: #d65d0e;">(</span>set-face-attribute
           face nil
           <span style="color: #fe8019;">:background</span> <span style="color: #458588;">(</span>color-desaturate-name
                        <span style="color: #b16286;">(</span>color-darken-name
                         <span style="color: #8ec07c;">(</span>face-attribute 'default <span style="color: #fe8019;">:background</span><span style="color: #8ec07c;">)</span> 15<span style="color: #b16286;">)</span> <span style="color: #fb4934; font-weight: bold;">50</span><span style="color: #458588; font-weight: bold;">)</span>
           <span style="color: #fe8019;">:foreground</span> <span style="color: #458588;">(</span>color-desaturate-name
                        <span style="color: #b16286;">(</span>funcall intensify
                                 <span style="color: #8ec07c;">(</span>face-attribute 'default <span style="color: #fe8019;">:foreground</span><span style="color: #8ec07c;">)</span> 20<span style="color: #b16286;">)</span> <span style="color: #fb4934; font-weight: bold;">90</span><span style="color: #458588; font-weight: bold;">)</span>
           <span style="color: #fe8019;">:weight</span> <span style="color: #458588;">(</span>face-attribute 'default <span style="color: #fe8019;">:weight</span><span style="color: #458588;">)</span>
           <span style="color: #fe8019;">:slant</span> <span style="color: #458588;">(</span>face-attribute 'default <span style="color: #fe8019;">:slant</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">* ivy-current-match -&gt; remove underline and add background</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">when</span> <span style="color: #d65d0e;">(</span>eq <span style="color: #458588;">(</span>face-attribute 'ivy-current-match <span style="color: #fe8019;">:underline</span><span style="color: #458588;">)</span> t<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>set-face-attribute 'ivy-current-match nil <span style="color: #fe8019;">:underline</span> 'unspecified<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">when</span> <span style="color: #458588;">(</span>eq <span style="color: #b16286;">(</span>face-attribute 'ivy-current-match <span style="color: #fe8019;">:background</span><span style="color: #b16286;">)</span> 'unspecified<span style="color: #458588;">)</span>
        <span style="color: #458588;">(</span><span style="color: #fb4934;">let*</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>default-bg <span style="color: #d65d0e;">(</span>face-attribute 'default <span style="color: #fe8019;">:background</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
               <span style="color: #8ec07c;">(</span>bg-1       <span style="color: #d65d0e;">(</span>funcall intensify default-bg 15<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
               <span style="color: #8ec07c;">(</span>bg-2       <span style="color: #d65d0e;">(</span>funcall anti-intensify default-bg 15<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
               <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Ensure background isn't too dark or light:</span>
               <span style="color: #8ec07c;">(</span>final-bg   <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span><span style="color: #fb4934;">if</span> <span style="color: #458588;">(</span>eq bg 'dark<span style="color: #458588;">)</span>
                                   <span style="color: #458588;">(</span>&gt; <span style="color: #b16286;">(</span>color-distance bg-1 <span style="color: #b8bb26;">"#000000"</span><span style="color: #b16286;">)</span> 5000<span style="color: #458588;">)</span>
                                 <span style="color: #458588;">(</span>&gt; <span style="color: #b16286;">(</span>color-distance bg-1 <span style="color: #b8bb26;">"#FFFFFF"</span><span style="color: #b16286;">)</span> 5000<span style="color: #458588;">)</span><span style="color: #458588;">)</span>
                               bg-1
                             bg-2<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
          <span style="color: #b16286;">(</span>set-face-attribute 'ivy-current-match nil <span style="color: #fe8019;">:background</span> final-bg<span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">* fix italic faces</span>
    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">(mapc</span>
    <span style="color: #7c6f64;">;;  </span><span style="color: #7c6f64;">(lambda (face)</span>
    <span style="color: #7c6f64;">;;    </span><span style="color: #7c6f64;">(when (eq (face-attribute face :slant) 'italic)</span>
    <span style="color: #7c6f64;">;;      </span><span style="color: #7c6f64;">(set-face-attribute face nil :family "Fira Mono Medium")))</span>
    <span style="color: #7c6f64;">;;  </span><span style="color: #7c6f64;">(face-list))</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">* Reset fci-mode</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">let</span> <span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>inhibit-message t<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>call-interactively 'fci-mode<span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>call-interactively 'fci-mode<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Settings for specific themes</span>
    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">****************************</span>

    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">cl-case</span> theme
      <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">* Gruxbox</span>
      <span style="color: #d65d0e;">(</span>'gruvbox
       <span style="color: #458588;">(</span>custom-theme-set-faces
        'gruvbox <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">fix hard-to-see org-mode colors</span>
        '<span style="color: #b16286;">(</span>org-verbatim <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>t <span style="color: #458588;">(</span><span style="color: #fe8019;">:foreground</span> <span style="color: #b8bb26;">"DarkGray"</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
        '<span style="color: #b16286;">(</span>org-document-info-keyword <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>t <span style="color: #458588;">(</span><span style="color: #fe8019;">:foreground</span> <span style="color: #b8bb26;">"DarkGoldenrod"</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>

      <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">* Tango</span>
      <span style="color: #d65d0e;">(</span>'tango
       <span style="color: #458588;">(</span>custom-theme-set-faces
        'tango
        '<span style="color: #b16286;">(</span>hl-line <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>t <span style="color: #458588;">(</span><span style="color: #fe8019;">:background</span> <span style="color: #b8bb26;">"#dddddd"</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>

      <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">* Tango-dark</span>
      <span style="color: #d65d0e;">(</span>'tango-dark
       <span style="color: #458588;">(</span>custom-theme-set-faces
        'tango-dark <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">fix crazy hl-line (bright yellow per default!)</span>
        '<span style="color: #b16286;">(</span>hl-line <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>t <span style="color: #458588;">(</span><span style="color: #fe8019;">:background</span> <span style="color: #b8bb26;">"#444444"</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>

    <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">* Eziam</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">when</span> <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">or</span> <span style="color: #458588;">(</span>equal theme 'eziam-dark<span style="color: #458588;">)</span> <span style="color: #458588;">(</span>equal theme 'eziam-light<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #d65d0e;">(</span>custom-theme-set-faces
       theme
       <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">- Less contrastive cursor</span>
       `<span style="color: #458588;">(</span>cursor <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>t <span style="color: #d65d0e;">(</span><span style="color: #fe8019;">:background</span>
                     ,<span style="color: #458588;">(</span>funcall
                       anti-intensify
                       <span style="color: #458588;">(</span>face-attribute 'default <span style="color: #fe8019;">:foreground</span><span style="color: #458588;">)</span> 25<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
       <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">- More contrastive paren match</span>
       `<span style="color: #458588;">(</span>show-paren-match <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>t <span style="color: #d65d0e;">(</span><span style="color: #fe8019;">:background</span>
                               ,<span style="color: #458588;">(</span>funcall
                                 anti-intensify
                                 <span style="color: #458588;">(</span>face-attribute 'default <span style="color: #fe8019;">:background</span><span style="color: #458588;">)</span> 25<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span>
      <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">- Fading rainbow-delimiters (from black to light gray)</span>
      <span style="color: #d65d0e;">(</span><span style="color: #fb4934;">cl-loop</span> for n in <span style="color: #458588;">(</span>number-sequence 1 9<span style="color: #458588;">)</span>
               do <span style="color: #458588;">(</span><span style="color: #fb4934;">let</span> <span style="color: #b16286;">(</span><span style="color: #8ec07c;">(</span>face-name <span style="color: #d65d0e;">(</span>concat
                                    <span style="color: #b8bb26;">"rainbow-delimiters-depth-"</span>
                                    <span style="color: #458588;">(</span>number-to-string n<span style="color: #458588;">)</span>
                                    <span style="color: #b8bb26;">"-face"</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
                        <span style="color: #8ec07c;">(</span>color <span style="color: #d65d0e;">(</span>funcall
                                intensify
                                <span style="color: #458588;">(</span>face-attribute 'default <span style="color: #fe8019;">:foreground</span><span style="color: #458588;">)</span>
                                <span style="color: #458588;">(</span>* n 6<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span>
                    <span style="color: #b16286;">(</span>custom-theme-set-faces
                     theme
                     <span style="color: #8ec07c;">(</span>list <span style="color: #d65d0e;">(</span>intern face-name<span style="color: #d65d0e;">)</span> `<span style="color: #d65d0e;">(</span><span style="color: #458588;">(</span>t <span style="color: #458588;">(</span><span style="color: #fe8019;">:foreground</span> ,color<span style="color: #458588;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">theme-reload</span> <span style="color: #b16286;">()</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">if</span> <span style="color: #8ec07c;">(</span>boundp 'current-theme<span style="color: #8ec07c;">)</span>
      <span style="color: #8ec07c;">(</span>theme-do-all current-theme<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"C-c R"</span><span style="color: #b16286;">)</span> #'theme-reload<span style="color: #458588;">)</span>
</pre>
</div>

<p>
It may look a bit busy, but that&rsquo;s because of the nature of setting face
attributes via Emacs Lisp.
</p>

<p>
Among some of the interesting settings are the custom <code>rainbow-delimiters</code> fading
from black to light gray - or from white to dark gray, if <code>eziam-dark</code> is loaded
instead of <code>eziam-light</code>.
</p>
</div>
</div>

<div id="outline-container-orge3e9e19" class="outline-4">
<h4 id="theme-switching"><a id="orge3e9e19"></a>Switching between themes</h4>
<div class="outline-text-4" id="text-theme-switching">
<p>
To switch themes, I simply use <code>load-theme</code>. There is one problem with that,
though. Per default, <code>load-theme</code> doesn&rsquo;t unload the old theme. The following
code, surely copied from the internet, fixes that:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org0b7aca3"><span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">- Disable previous theme when enabling new theme</span>
<span style="color: #458588;">(</span>add-hook 'after-init-hook
          <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">defadvice</span> <span style="color: #fabd2f;">load-theme</span>
                         <span style="color: #d65d0e;">(</span>before theme-dont-propagate activate<span style="color: #d65d0e;">)</span>
                       <span style="color: #d65d0e;">(</span>mapc #'disable-theme custom-enabled-themes<span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org08edc28" class="outline-3">
<h3 id="org08edc28"><span class="section-number-3">11.2</span> Fonts</h3>
<div class="outline-text-3" id="text-11-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #458588;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #fabd2f;">/setup-fonts</span> <span style="color: #b16286;">(</span><span style="color: #d3869b;">&amp;optional</span> r<span style="color: #b16286;">)</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">let</span> <span style="color: #8ec07c;">(</span><span style="color: #d65d0e;">(</span>sans-serif-font <span style="color: #458588;">(</span><span style="color: #fb4934;">cl-case</span> system-type
                           <span style="color: #b16286;">(</span>'darwin    <span style="color: #b8bb26;">"Lucida Grande"</span><span style="color: #b16286;">)</span>
                           <span style="color: #b16286;">(</span>'gnu/linux <span style="color: #b8bb26;">"Verdana"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span>
    <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">when</span> <span style="color: #d65d0e;">(</span>eq system-type 'darwin<span style="color: #d65d0e;">)</span>
      <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Replace Sans Serif with Lucida Grande</span>
      <span style="color: #d65d0e;">(</span>mapc
       <span style="color: #458588;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #b16286;">(</span>face<span style="color: #b16286;">)</span>
         <span style="color: #b16286;">(</span><span style="color: #fb4934;">when</span> <span style="color: #8ec07c;">(</span>string-equal <span style="color: #d65d0e;">(</span>face-attribute face <span style="color: #fe8019;">:family</span><span style="color: #d65d0e;">)</span> <span style="color: #b8bb26;">"Sans Serif"</span><span style="color: #8ec07c;">)</span>
           <span style="color: #8ec07c;">(</span>set-face-attribute face nil <span style="color: #fe8019;">:family</span> sans-serif-font<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
       <span style="color: #458588;">(</span>face-list<span style="color: #458588;">)</span><span style="color: #d65d0e;">)</span><span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>advice-add #'theme-do-all <span style="color: #fe8019;">:after</span> #'/setup-fonts<span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org09ec978" class="outline-2">
<h2 id="lang"><a id="org09ec978"></a><span class="section-number-2">12</span> Language configuration</h2>
<div class="outline-text-2" id="text-lang">
</div>

<div id="outline-container-org0bfc973" class="outline-3">
<h3 id="spelling"><a id="org0bfc973"></a><span class="section-number-3">12.1</span> Spelling</h3>
<div class="outline-text-3" id="text-spelling">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org6e2fb03"><span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">(add-to-list 'ispell-dictionary-alist</span>
<span style="color: #7c6f64;">;;              </span><span style="color: #7c6f64;">'("swedish-hunspell"</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">"[[:alpha:]]"</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">"[</span><span style="color: #7c6f64;">^</span><span style="color: #7c6f64;">[:alpha:]]"</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">"[']"</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">t</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">("-d" "sv_SE")</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">nil</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">utf-8))</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">(add-to-list 'ispell-dictionary-alist</span>
<span style="color: #7c6f64;">;;              </span><span style="color: #7c6f64;">'("english-hunspell"</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">"[[:alpha:]]"</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">"[</span><span style="color: #7c6f64;">^</span><span style="color: #7c6f64;">[:alpha:]]"</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">"[']"</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">t</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">("-d" "en_US")</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">nil</span>
<span style="color: #7c6f64;">;;                </span><span style="color: #7c6f64;">utf-8))</span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">(setq ispell-program-name "hunspell"</span>
<span style="color: #7c6f64;">;;       </span><span style="color: #7c6f64;">ispell-dictionary   "swedish-hunspell")</span>

<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Ignore the following Org markup:</span>

<span style="color: #458588;">(</span>add-to-list 'ispell-skip-region-alist '<span style="color: #b16286;">(</span><span style="color: #b8bb26;">"^#\\+BEGIN_SRC "</span>. <span style="color: #b8bb26;">"#\\+END_SRC$"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>add-to-list 'ispell-skip-region-alist '<span style="color: #b16286;">(</span><span style="color: #b8bb26;">"^#\\+BEGIN_EXAMPLE "</span>. <span style="color: #b8bb26;">"#\\+END_EXAMPLE$"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>add-to-list 'ispell-skip-region-alist '<span style="color: #b16286;">(</span><span style="color: #b8bb26;">"\:PROPERTIES\:$"</span> . <span style="color: #b8bb26;">"\:END\:$"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>add-to-list 'ispell-skip-region-alist '<span style="color: #b16286;">(</span><span style="color: #b8bb26;">"\\[fn:.+:"</span> . <span style="color: #b8bb26;">"\\]"</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>add-to-list 'ispell-skip-region-alist '<span style="color: #b16286;">(</span><span style="color: #b8bb26;">"=.*"</span> . <span style="color: #b8bb26;">".*="</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span> <span style="color: #7c6f64;">; </span><span style="color: #7c6f64;">org verbatim</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8252af7" class="outline-3">
<h3 id="swe"><a id="org8252af7"></a><span class="section-number-3">12.2</span> Swedish mode</h3>
<div class="outline-text-3" id="text-swe">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgd96a71f"><span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Based on work by Moritz Ulrich <a href="mailto:ulrich.moritz%40googlemail.com">&lt;ulrich.moritz@googlemail.com&gt;</a></span>
<span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Published under GNU General Public License</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">defvar</span> <span style="color: #83a598;">swedish-mode-map</span> <span style="color: #b16286;">(</span>make-keymap<span style="color: #b16286;">)</span> <span style="color: #b8bb26;">"Swedish mode keymap."</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span>define-key swedish-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"s-["</span><span style="color: #b16286;">)</span>  <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>insert ?&#229;<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>define-key swedish-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"s-'"</span><span style="color: #b16286;">)</span>  <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>insert ?&#228;<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>define-key swedish-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"s-;"</span><span style="color: #b16286;">)</span>  <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>insert ?&#246;<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>define-key swedish-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"s-{"</span><span style="color: #b16286;">)</span>  <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>insert ?&#197;<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>define-key swedish-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"s-\""</span><span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>insert ?&#196;<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
<span style="color: #458588;">(</span>define-key swedish-mode-map <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"s-:"</span><span style="color: #b16286;">)</span>  <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>insert ?&#214;<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">define-minor-mode</span> <span style="color: #fabd2f;">swedish-mode</span>
  <span style="color: #b8bb26;">"A mode for conveniently using Swedish letters in Emacs."</span>
  nil
  <span style="color: #fe8019;">:lighter</span> <span style="color: #b8bb26;">" &#229;&#228;&#246;"</span>
  swedish-mode-map<span style="color: #458588;">)</span>

<span style="color: #458588;">(</span><span style="color: #fb4934;">provide</span> '<span style="color: #d3869b;">swedish-mode</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a91193" class="outline-3">
<h3 id="combining-acute-accent"><a id="org3a91193"></a><span class="section-number-3">12.3</span> Combining acute accent</h3>
<div class="outline-text-3" id="text-combining-acute-accent">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org1243774"><span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Insert combining acute accent</span>
<span style="color: #458588;">(</span>global-set-key <span style="color: #b16286;">(</span>kbd <span style="color: #b8bb26;">"C-c 8 '"</span><span style="color: #b16286;">)</span> <span style="color: #b16286;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #8ec07c;">()</span> <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #8ec07c;">)</span> <span style="color: #8ec07c;">(</span>insert-char 769<span style="color: #8ec07c;">)</span><span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org303ccbd" class="outline-2">
<h2 id="rsi"><a id="org303ccbd"></a><span class="section-number-2">13</span> Preventing repeated strain injury</h2>
<div class="outline-text-2" id="text-rsi">
</div>
</div>


<div id="outline-container-org5ebb308" class="outline-2">
<h2 id="org5ebb308"><span class="section-number-2">14</span> Operating systems</h2>
<div class="outline-text-2" id="text-14">
</div><div id="outline-container-orgfd69ac6" class="outline-3">
<h3 id="wsl"><a id="orgfd69ac6"></a><span class="section-number-3">14.1</span> Windows Subsystem for Linux (WSL)</h3>
<div class="outline-text-3" id="text-wsl">
<p>
I only own Windows PCs, with Windows installed on every single one, and I do
rely on Windows for a lot of things: PC games, Microsoft Word, the experience of
using a commercial and well-functioning operating system &#x2026; My only problem is
programming. I <i>cannot</i> program on Windows. <code>cmd.exe</code>, as well as the newer
PowerShell, is unusable - not necessarily because they suck, but because I&rsquo;m
very used to *nix systems.
</p>

<p>
<i>Bash on Ubuntu on Windows: Windows Subsystem for Linux</i> (WSL for short) solves
that problem for me. It isn&rsquo;t perfect and everything doesn&rsquo;t work great. But
most things work really well - surprisingly well, even. I am as amazed as
impressed by the work done by the WSL team. My respect for Microsoft, as well as
the Windows&rsquo; potential as a powerful development environment, is higher than
ever.
</p>

<p>
Using WSL does mean I have to do some things a bit differently, and adjust my
configuration accordingly. Most of this configuration happens in my Zsh
configuration files, but some of it inevitably leaks into my Emacs
configuration.
</p>
</div>

<div id="outline-container-org5b76f77" class="outline-4">
<h4 id="launching-emacs"><a id="org5b76f77"></a>Launching Emacs</h4>
<div class="outline-text-4" id="text-launching-emacs">
<p>
Using the graphical version of Emacs on WSL is a bit trickier than just the
plain old terminal verison, as you need an X server to run it. But as it turns
out, there are X servers for Windows! Personally, I use <a href="https://sourceforge.net/projects/vcxsrv/">VcXsrv</a>, because I&rsquo;ve
heard it&rsquo;s good, but <a href="http://www.straightrunning.com/XmingNotes/">Xming</a> seems to be a solid alternative.
</p>

<p>
I use VcXsrv in its &ldquo;multiple windows&rdquo; mode. This means that every X window will
behave like any other normal Windows window (that&rsquo;s a lot of &ldquo;windows&rdquo;). It will
have a Windows title bar and be fully integrated into the native window manager.
</p>

<p>
To launch Emacs without having to use a terminal, I actually use a program
part of the Xming project (but bundled separately) called <code>run.exe</code>. It provides a
way of launching X applications and disowning them, so you won&rsquo;t need to have a
terminal open in order to run your GUI programs.
</p>

<p>
I keep <code>run.exe</code> in my Windows <code>PATH</code>, and I have the following shortcut as an icon
on my desktop:
</p>

<pre class="example">
run.exe bash.exe -c "LAUNCH_AT_START='emacs' zsh"
</pre>

<p>
Now, the code above could have been simpler if I just used bash. However, my
main shell is <code>zsh</code> and I&rsquo;d like for Emacs to use that shell, along with my <code>zsh</code>
configuration, specifically so that I can access my custom-set <code>$PATH</code>.
</p>

<p>
The following code at the end of my <code>zsh</code> configuration makes it work:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #fe8019;">local</span> <span style="color: #83a598;">LAUNCH_PROGRAM</span>=0
<span style="color: #fe8019;">local</span> <span style="color: #83a598;">LAUNCH_PROGRAM</span>=<span style="color: #b8bb26;">"$LAUNCH_AT_START"</span>
<span style="color: #fe8019;">export</span> <span style="color: #83a598;">LAUNCH_AT_START</span>=0 <span style="color: #7c6f64;"># </span><span style="color: #7c6f64;">prevent launched program to launch more programs</span>

<span style="color: #fb4934;">case</span> <span style="color: #b8bb26;">"$LAUNCH_PROGRAM"</span><span style="color: #fb4934;"> in</span>
    emacs)
        nohup emacs &amp;&gt; /dev/null &amp; <span style="color: #fe8019;">disown</span>; <span style="color: #fb4934;">exit</span>;;
    gnome-terminal)
        nohup gnome-terminal &amp;&gt; /dev/null &amp; <span style="color: #fe8019;">disown</span>; <span style="color: #fb4934;">exit</span>;;
    i3)
        nohup i3 &amp;&gt; /dev/null &amp; <span style="color: #fe8019;">disown</span>; <span style="color: #fb4934;">exit</span>;;
<span style="color: #fb4934;">esac</span>
</pre>
</div>

<p>
In the shell script I also have a launch option for <code>gnome-terminal</code>, which I like
to use instead of the default <code>bash.exe</code>.
</p>
</div>
</div>

<div id="outline-container-orgc96bcd1" class="outline-4">
<h4 id="wsl:default"><a id="orgc96bcd1"></a>Default programs</h4>
<div class="outline-text-4" id="text-wsl:default">
<p>
I use WSL for most development tools - like Emacs, Zsh and the odd local web
server - but I use native Windows programs for things like music playing and
web browsing.
</p>
</div>

<div id="outline-container-org0ee40da" class="outline-5">
<h5 id="wsl:web-browser"><a id="org0ee40da"></a>Web browser</h5>
<div class="outline-text-5" id="text-wsl:web-browser">
</div>

<ul class="org-ul"><li><a id="org52ade66"></a>Problem<br /><div class="outline-text-6" id="text-org52ade66">
<p>
My web browser of choice is Firefox, because of the extensibility and
reliability. Emacs can be configured to use Firefox by customizing
<code>browse-url-browser-function</code> and setting it to <i>Firefox</i>. This will make
Emacs attempt to launch Firefox when I click on a link.
</p>

<p>
Of course, I haven&rsquo;t got Firefox installed on my WSL system, but I symlinked
<code>~/bin/firefox</code> to the path of the Windows version of Firefox:
</p>

<div class="org-src-container">
<pre class="src src-sh">ln -s /mnt/c/Program<span style="color: #b8bb26;">\ </span>Files/Mozilla<span style="color: #b8bb26;">\ </span>Firefox/firefox.exe ~/bin/firefox
</pre>
</div>

<p>
For a while, this solution worked fine. However, not all modes respect the
<code>browse-url-browser-function</code> setting. org-mode tries to use
<code>sensible-browser</code>, which relies on the <code>BROWSER</code> variable. To make
<code>sensible-browser</code> use Firefox, I simply put the following in my Zsh
configuration:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #fe8019;">export</span> <span style="color: #83a598;">BROWSER</span>=<span style="color: #b8bb26;">"firefox"</span>
</pre>
</div>

<p>
Still, when org-mode tries to open the HTML file it just exported, it seems
to run into some problem. A Firefox window opens, but it&rsquo;s empty, without
any URL in the address bar!
</p>

<p>
This happens when Emacs tries to open <i>any</i> file in the web browser, simply
because <code>firefox.exe</code> won&rsquo;t recognize any Linux path. It needs a <i>Windows</i>
path.
</p>
</div></li>

<li><a id="orgb40e6e9"></a>Solution<br /><div class="outline-text-6" id="text-orgb40e6e9">
<p>
To solve this once and for all, I scrapped my old symlinks and aliases and
instead, wrote the following shell script:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #fb4934;">if</span> <span style="color: #458588;">[</span><span style="color: #b16286;">[</span> $<span style="color: #83a598;">1</span> =~ ^https?:// <span style="color: #b16286;">]</span><span style="color: #458588;">]</span>; <span style="color: #fb4934;">then</span>
    <span style="color: #fe8019;">local</span> <span style="color: #83a598;">open_path</span>=<span style="color: #b8bb26;">"$1"</span>
<span style="color: #fb4934;">elif</span> <span style="color: #458588;">[</span><span style="color: #b16286;">[</span> $<span style="color: #83a598;">1</span> =~ ^/mnt/c <span style="color: #b16286;">]</span><span style="color: #458588;">]</span>; <span style="color: #fb4934;">then</span>
    <span style="color: #fe8019;">local</span> <span style="color: #83a598;">linux_path</span>=<span style="color: #b8bb26;">"/mnt/c"</span>
    <span style="color: #fe8019;">local</span> <span style="color: #83a598;">windows_path</span>=<span style="color: #b8bb26;">"file:///C:/"</span>
    <span style="color: #fe8019;">local</span> <span style="color: #83a598;">open_path</span>=<span style="color: #b8bb26;">"${1/$linux_path/$windows_path}"</span>
<span style="color: #fb4934;">else</span>
    <span style="color: #fe8019;">local</span> <span style="color: #83a598;">abs_path</span>=$<span style="color: #458588;">(</span>readlink -f $<span style="color: #83a598;">1</span><span style="color: #458588;">)</span>
    <span style="color: #fe8019;">local</span> <span style="color: #83a598;">open_path</span>=<span style="color: #b8bb26;">"file:///C:/Users/JohnAJ/AppData/Local/lxss$abs_path"</span>
<span style="color: #fb4934;">fi</span>

/mnt/c/Program<span style="color: #b8bb26;">\ </span>Files/Mozilla<span style="color: #b8bb26;">\ </span>Firefox/firefox.exe $<span style="color: #83a598;">open_path</span>
</pre>
</div>

<p>
The script treats any argument starting with <code>http://</code> or <code>https://</code> as normal URLs.
Any other path, it tries to convert to the equivalent Windows path.
</p>

<p>
At first, I didn&rsquo;t have the <i>elif</i>-clause, but I noticed that sometimes, Emacs
would try to open in the web browser a file that was on the Windows-side of the
filesystem - that is, with a path starting with <code>/mnt/c</code>.
</p>

<p>
Within the Linux system, <code>/mnt/c</code> is an access point to all files on the Windows
installation. Within the Windows system, <code>C:\Users\JohnAJ\AppData\Local\lxss</code> is
an access point to the Linux file system. But despite that,
<code>C:\Users\JohnAJ\AppData\Local\lxss\mnt\c</code> does <i>not</i> resolve to <code>C:\</code>.
</p>

<p>
For this reason, I couldn&rsquo;t just tell <code>firefox.exe</code> to open
<code>file:///C:/Users/JohnAJ/AppData/Local/lxss/mnt/c/</code>. To Windows programs, it&rsquo;s an
empty directory. I therefore added a special case for all paths starting with
<code>/mnt/c</code>, redirecting straight to <code>file:///C:/</code>, which isn&rsquo;t an empty directory.
</p>

<p>
I saved the script as <code>~/bin/wsl-browser</code>, the <code>~/bin</code> directory being in my <code>$PATH</code>,
and gave myself permissions to run it:
</p>

<div class="org-src-container">
<pre class="src src-sh">chmod +x ~/bin/wsl-browser
</pre>
</div>

<p>
Additionally, I symlinked both <code>firefox</code> and <code>sensible-browser</code>
to the file. This way, any tool on my system that tries to use one of those
programs will use my script instead.
</p>

<p>
In Emacs, my default browser is <code>firefox</code>, so that it remains compatible
with other systems, where I don&rsquo;t use my <code>wsl-browser</code> script.
</p>
</div></li></ul>
</div>
</div>
</div>


<div id="outline-container-org0801570" class="outline-3">
<h3 id="osx"><a id="org0801570"></a><span class="section-number-3">14.2</span> Mac OS X</h3>
<div class="outline-text-3" id="text-osx">
<p>
I very rarely use Mac OS X, but when I do, I like my Emacs configuration to
work - and nicely, at that!
</p>
</div>

<div id="outline-container-org82d89da" class="outline-4">
<h4 id="org82d89da">Fonts</h4>
<div class="outline-text-4" id="text-org82d89da">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga838a66"><span style="color: #458588;">(</span><span style="color: #fb4934;">when</span> <span style="color: #b16286;">(</span>eq system-type 'darwin<span style="color: #b16286;">)</span>
  <span style="color: #7c6f64;">;; </span><span style="color: #7c6f64;">Fix selections</span>
  <span style="color: #b16286;">(</span><span style="color: #fb4934;">defalias</span> '<span style="color: #fabd2f;">x-selection-owner-p</span> 'ns-selection-owner-p<span style="color: #b16286;">)</span><span style="color: #458588;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org9c7d97d" class="outline-2">
<h2 id="org9c7d97d"><span class="section-number-2">15</span> Credits</h2>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: John AnkarstrÃ¶m</p>
<p class="date">Created: 2017-07-15 Sat 21:41</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
